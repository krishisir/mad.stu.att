<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ছাত্র-ছাত্রী হাজিরা - মাদ্রাসা ম্যানেজমেন্ট</title>
    
    <!-- PWA Metadata -->
    <meta name="application-name" content="মাদ্রাসা হাজিরা">
    <meta name="apple-mobile-web-app-title" content="মাদ্রাসা হাজিরা">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#764ba2">
    <meta name="msapplication-TileColor" content="#764ba2">
    <meta name="msapplication-TileImage" content="https://i.ibb.co.com/qLwTQr1Z/android-chrome-192x192.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" sizes="512x512" href="https://i.ibb.co.com/m52WMKg6/android-chrome-512x512.png">    
    <!-- External Resources -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap');
        
        * {
            font-family: 'Hind Siliguri', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-top: 70px;
        }
        
        /* Navigation Styles */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #4f46e5 0%, #3730a3 100%);
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .nav-container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
            text-decoration: none;
        }
        
        .logo-icon {
            background: rgba(255,255,255,0.2);
            padding: 8px;
            border-radius: 10px;
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: 700;
        }
        
        .logo-subtext {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .nav-item {
            position: relative;
        }
        
        .nav-link {
            color: white;
            padding: 12px 18px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            text-decoration: none;
            font-weight: 500;
        }
        
        .nav-link:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .nav-link.active {
            background: rgba(255,255,255,0.2);
            font-weight: 600;
        }
        
        /* হামবার্গার মেনু বাটন - এখন সব ডিভাইসে দেখা যাবে */
        .hamburger-menu-btn {
            display: flex;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            align-items: center;
            justify-content: center;
        }
        
        /* মোবাইল মেনু */
        .mobile-menu {
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #4f46e5 0%, #3730a3 100%);
            padding: 20px;
            display: none;
            flex-direction: column;
            gap: 10px;
            z-index: 999;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .mobile-menu.show {
            display: flex;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Main Content Styles */
        .main-content {
            padding: 20px;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4f46e5 0%, #3730a3 100%);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #3730a3 0%, #312e81 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .btn-warning:hover {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        
        .btn-info:hover {
            background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .badge-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .badge-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .badge-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .badge-info {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        
        .badge-purple {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }
        
        .search-box {
            width: 100%;
            padding: 14px 24px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 20px;
            background: white;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .search-box:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        th {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            padding: 18px;
            text-align: left;
            font-weight: 700;
            color: #374151;
            border-bottom: 2px solid #d1d5db;
            font-size: 15px;
        }
        
        td {
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
            vertical-align: middle;
        }
        
        tr:hover {
            background: #f8fafc;
        }
        
        .status-present {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%) !important;
            color: #065f46 !important;
            border-left: 5px solid #10b981 !important;
        }
        
        .status-absent {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%) !important;
            color: #991b1b !important;
            border-left: 5px solid #ef4444 !important;
        }
        
        .attendance-btn {
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid;
            font-weight: 600;
            cursor: pointer;
            margin: 3px;
            transition: all 0.2s;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .attendance-btn:hover {
            transform: scale(1.05);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 35px;
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.4s ease;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .hidden {
            display: none;
        }
        
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            border-radius: 18px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.4s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(135deg, #4f46e5 0%, #8b5cf6 100%);
        }
        
        .stat-card:hover {
            transform: translateY(-8px);
            border-color: #4f46e5;
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        
        .stat-number {
            font-size: 38px;
            font-weight: bold;
            margin: 15px 0;
            background: linear-gradient(135deg, #374151 0%, #111827 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 18px 25px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            animation: slideInRight 0.3s ease;
            max-width: 400px;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .toast-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .toast-error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .toast-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .toast-info {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }
        
        .class-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
            display: inline-block;
        }
        
        .class-ibtidayee {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #78350f;
        }
        
        .class-dakhil {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            color: #1e3a8a;
        }
        
        .class-alim {
            background: linear-gradient(135deg, #c084fc 0%, #8b5cf6 100%);
            color: #4c1d95;
        }
        
        .confirmation-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .confirmation-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .confirmation-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }
        
        .class-filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .class-filter-btn {
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            background: white;
            color: #4b5563;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .class-filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .class-filter-btn.active {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border-color: #4f46e5;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
        }
        
        .action-btn-edit {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        
        .action-btn-delete {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .action-btn-delete:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        .action-btn-view {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .teacher-badge {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            margin-left: 5px;
        }
        
        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }
        
        input:checked + .slider {
            background-color: #4f46e5;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .slider.round {
            border-radius: 34px;
        }
        
        .slider.round:before {
            border-radius: 50%;
        }
        
        /* PWA Specific Styles */
        .pwa-install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 10000;
            display: none;
            animation: slideUp 0.3s ease;
        }
        
        .pwa-install-prompt.show {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .pwa-install-prompt-content {
            flex: 1;
        }
        
        .pwa-install-prompt-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .pwa-install-prompt-description {
            font-size: 13px;
            opacity: 0.9;
        }
        
        .pwa-install-buttons {
            display: flex;
            gap: 10px;
        }
        
        .pwa-install-btn {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
        }
        
        .pwa-install-primary {
            background: white;
            color: #4f46e5;
        }
        
        .pwa-install-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        
        .offline-indicator {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #ef4444;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
            display: none;
        }
        
        .offline-indicator.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .online-indicator {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            display: none;
        }
        
        .online-indicator.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .sync-indicator {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: #f59e0b;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
            display: none;
        }
        
        .sync-indicator.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .pwa-button {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 8px 15px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
            margin-left: 10px;
        }
        
        .attendance-column {
            width: 200px;
        }
        
        /* Firebase Connection Status */
        .firebase-status {
            position: fixed;
            top: 80px;
            left: 20px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .firebase-connected {
            background: #10b981;
            color: white;
        }
        
        .firebase-disconnected {
            background: #ef4444;
            color: white;
        }
        
        .firebase-syncing {
            background: #f59e0b;
            color: white;
        }
        
        /* উন্নত ডিলিট মডেল স্টাইল */
        .delete-confirmation-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .delete-confirmation-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            animation: slideUp 0.3s ease;
        }
        
        .delete-icon {
            font-size: 60px;
            color: #ef4444;
            margin-bottom: 20px;
        }
        
        .delete-student-info {
            background: #fef2f2;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
        }
        
        .delete-student-info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .delete-student-info-label {
            font-weight: 600;
            color: #4b5563;
        }
        
        .delete-student-info-value {
            font-weight: 700;
            color: #111827;
        }
        
        .delete-warning {
            background: #fffbeb;
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
        }
        
        .delete-warning-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            color: #92400e;
            margin-bottom: 10px;
        }
        
        .delete-warning-icon {
            color: #f59e0b;
        }
        
        .delete-warning-list {
            list-style-type: none;
            padding-left: 0;
            margin: 0;
        }
        
        .delete-warning-list li {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 8px;
            color: #92400e;
        }
        
        .delete-warning-list li i {
            color: #f59e0b;
            margin-top: 3px;
        }
        
        .delete-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .delete-btn {
            flex: 1;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 16px;
        }
        
        .delete-cancel-btn {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
        }
        
        .delete-cancel-btn:hover {
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .delete-confirm-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .delete-confirm-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(239, 68, 68, 0.3);
        }
        
        /* বাটন এনিমেশন */
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }
        
        /* অতীত তারিখের হাজিরা বাটন */
        .past-date-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .past-date-btn:hover {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            transform: translateY(-2px);
        }
        
        .date-picker-container {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .selected-date-display {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 10px;
            display: inline-block;
        }
        
        @media (max-width: 768px) {
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
            
            table {
                display: block;
                overflow-x: auto;
            }
            
            .modal-content {
                padding: 25px;
            }
            
            .confirmation-buttons {
                flex-direction: column;
            }
            
            .delete-buttons {
                flex-direction: column;
            }
            
            .class-filter-buttons {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 4px;
            }
            
            .pwa-install-prompt {
                bottom: 10px;
                left: 10px;
                right: 10px;
            }
            
            .attendance-column {
                width: 150px;
            }
            
            .firebase-status {
                top: 140px;
                left: 10px;
                font-size: 10px;
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-content">
                <!-- Logo -->
                <a href="#" class="logo" onclick="showPage('dashboard'); return false;">
                    <div class="logo-icon">
                        <i class="fas fa-mosque"></i>
                    </div>
                    <div>
                        <div class="logo-text">ছাত্র-ছাত্রী হাজিরা</div>
                        <div class="logo-subtext">মেহেরপুর আনছারুল উলূম আলিম মাদ্রাসা</div>
                    </div>
                </a>
                
                <!-- Desktop Menu Button (Three Lines) -->
                <button class="hamburger-menu-btn" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <!-- Mobile Menu (Now used for both mobile and desktop) -->
            <div class="mobile-menu" id="mobileMenu">
                <a href="#" class="nav-link active" onclick="navigateToPage('dashboard'); return false;">
                    <i class="fas fa-home"></i>
                    ড্যাশবোর্ড
                </a>
                <a href="#" class="nav-link" onclick="navigateToPage('attendance'); return false;">
                    <i class="fas fa-calendar-check"></i>
                    হাজিরা
                </a>
                <a href="#" class="nav-link" onclick="navigateToPage('students'); return false;">
                    <i class="fas fa-users"></i>
                    ছাত্র তালিকা
                </a>
                <a href="#" class="nav-link" onclick="navigateToPage('reports'); return false;">
                    <i class="fas fa-chart-bar"></i>
                    রিপোর্ট
                </a>
                <a href="#" class="nav-link" onclick="navigateToPage('classes'); return false;">
                    <i class="fas fa-graduation-cap"></i>
                    শ্রেণি ব্যবস্থাপনা
                </a>
                <a href="#" class="nav-link" onclick="navigateToPage('settings'); return false;">
                    <i class="fas fa-cog"></i>
                    সেটিংস
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Page -->
        <div id="dashboard" class="page active">
            <div class="max-w-7xl mx-auto">
                <!-- হেডার -->
                <div class="card mb-6">
                    <div class="flex flex-col md:flex-row justify-between items-center">
                        <div class="mb-4 md:mb-0">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-gradient-to-r from-purple-600 to-blue-600 p-3 rounded-xl">
                                    <i class="fas fa-mosque text-2xl text-white"></i>
                                </div>
                                <div>
                                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-1">ছাত্র-ছাত্রী হাজিরা ব্যবস্থাপনা</h1>
                                    <p class="text-gray-600">মেহেরপুর আনছারুল উলূম আলিম মাদ্রাসা, গোলাপগঞ্জ, সিলেট</p>
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <span class="badge badge-info"><i class="fas fa-hashtag"></i> EIIN: ১৩০২৯০</span>
                                <span class="badge badge-purple"><i class="fas fa-code"></i> কোড: ১৮৭৫২</span>
                                <span id="currentDate" class="badge badge-success"><i class="fas fa-calendar-day"></i> আজ: লোড হচ্ছে...</span>
                                <span id="pwaStatus" class="badge badge-warning"><i class="fas fa-mobile-alt"></i> PWA</span>
                                <span id="firebaseBadge" class="badge badge-info hidden"><i class="fas fa-database"></i> ফায়ারবেস</span>
                            </div>
                        </div>
                        <div class="flex flex-col gap-3">
                            <button onclick="showAddStudentModal()" class="btn btn-primary">
                                <i class="fas fa-user-plus"></i> নতুন ছাত্র যোগ
                            </button>
                            <button onclick="showClassSheets()" class="btn btn-info">
                                <i class="fas fa-clipboard-list"></i> শ্রেণি হাজিরা সীট
                            </button>
                            <button onclick="showTeacherManagement()" class="btn btn-warning">
                                <i class="fas fa-chalkboard-teacher"></i> শিক্ষক ব্যবস্থাপনা
                            </button>
                            <button onclick="addToHomeScreen()" class="btn btn-success hidden" id="installButton">
                                <i class="fas fa-download"></i> অ্যাপ ইন্সটল
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ড্যাশবোর্ড স্ট্যাটস -->
                <div class="dashboard-stats">
                    <div class="stat-card" onclick="showStudents('present')">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700">উপস্থিত</h3>
                                <p class="text-gray-500 text-sm mt-1">আজকের উপস্থিত ছাত্র</p>
                            </div>
                            <div class="bg-gradient-to-r from-green-100 to-green-50 p-4 rounded-full">
                                <i class="fas fa-user-check text-3xl text-green-600"></i>
                            </div>
                        </div>
                        <div class="stat-number text-green-600" id="presentCount">০</div>
                    </div>
                    
                    <div class="stat-card" onclick="showStudents('absent')">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700">অনুপস্থিত</h3>
                                <p class="text-gray-500 text-sm mt-1">আজকের অনুপস্থিত ছাত্র</p>
                            </div>
                            <div class="bg-gradient-to-r from-red-100 to-red-50 p-4 rounded-full">
                                <i class="fas fa-user-times text-3xl text-red-600"></i>
                            </div>
                        </div>
                        <div class="stat-number text-red-600" id="absentCount">০</div>
                    </div>
                    
                    <div class="stat-card" onclick="showAllStudents()">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700">মোট ছাত্র</h3>
                                <p class="text-gray-500 text-sm mt-1">সকল ছাত্র-ছাত্রী</p>
                            </div>
                            <div class="bg-gradient-to-r from-blue-100 to-blue-50 p-4 rounded-full">
                                <i class="fas fa-users text-3xl text-blue-600"></i>
                            </div>
                        </div>
                        <div class="stat-number text-blue-600" id="totalCount">০</div>
                    </div>
                    
                    <div class="stat-card" onclick="showTodayReport()">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700">উপস্থিতি হার</h3>
                                <p class="text-gray-500 text-sm mt-1">আজকের উপস্থিতি</p>
                            </div>
                            <div class="bg-gradient-to-r from-purple-100 to-purple-50 p-4 rounded-full">
                                <i class="fas fa-percentage text-3xl text-purple-600"></i>
                            </div>
                        </div>
                        <div class="stat-number text-purple-600" id="attendanceRate">০%</div>
                    </div>
                </div>

                <!-- সাপ্তাহিক রিপোর্ট -->
                <div class="card">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                            <div class="bg-gradient-to-r from-green-500 to-emerald-500 p-2 rounded-lg">
                                <i class="fas fa-chart-bar text-white"></i>
                            </div>
                            এই সপ্তাহের হাজিরা রিপোর্ট
                        </h2>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="showWeeklyReport()" class="btn btn-info">
                                <i class="fas fa-expand"></i> বিস্তারিত দেখুন
                            </button>
                            <button onclick="exportData()" class="btn btn-success">
                                <i class="fas fa-download"></i> ডেটা ডাউনলোড
                            </button>
                            <button onclick="showTeacherManagement()" class="btn btn-warning">
                                <i class="fas fa-chalkboard-teacher"></i> শিক্ষক দেখুন
                            </button>
                        </div>
                    </div>
                    <div id="weeklyReport" class="grid grid-cols-2 md:grid-cols-7 gap-3">
                        <!-- সাপ্তাহিক ডেটা লোড হবে -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Attendance Page -->
        <div id="attendance" class="page">
            <div class="max-w-7xl mx-auto">
                <!-- আজকের হাজিরা -->
                <div class="card">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <div class="bg-gradient-to-r from-blue-500 to-purple-500 p-2 rounded-lg">
                                    <i class="fas fa-calendar-day text-white"></i>
                                </div>
                                আজকের হাজিরা (<span id="todayDate2" class="text-blue-600">লোড হচ্ছে...</span>)
                            </h2>
                            <p class="text-gray-600 text-sm mt-1">নিচের তালিকা থেকে ছাত্রদের হাজিরা মার্ক করুন</p>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="confirmAction('markAllPresent', 'সবাইকে উপস্থিত মার্ক করতে চান?', 'এই কাজটি বাতিল করা যাবে না।')" 
                                    class="btn btn-success">
                                <i class="fas fa-check-circle"></i> সবাই উপস্থিত
                            </button>
                            <button onclick="confirmAction('saveAttendance', 'হাজিরা সংরক্ষণ করতে চান?', 'সংরক্ষণের পর পরিবর্তন করা যাবে না।')" 
                                    class="btn btn-primary">
                                <i class="fas fa-save"></i> সংরক্ষণ
                            </button>
                            <button onclick="showPastDateAttendance()" class="past-date-btn">
                                <i class="fas fa-calendar-alt"></i> অতীত তারিখের হাজিরা
                            </button>
                            <button onclick="showClassSheets()" class="btn btn-info">
                                <i class="fas fa-print"></i> শ্রেণি সীট
                            </button>
                        </div>
                    </div>

                    <!-- অতীত তারিখ সিলেক্টর -->
                    <div id="pastDateSelector" class="date-picker-container hidden">
                        <div class="flex flex-col md:flex-row items-center gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-calendar-alt text-blue-500 mr-2"></i>
                                    অতীত তারিখ নির্বাচন করুন
                                </label>
                                <input type="date" id="pastDateInput" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition">
                            </div>
                            <div>
                                <button onclick="loadPastDateAttendance()" class="btn btn-primary">
                                    <i class="fas fa-search"></i> হাজিরা দেখুন
                                </button>
                                <button onclick="closePastDateSelector()" class="btn bg-gradient-to-r from-gray-500 to-gray-600 ml-2">
                                    <i class="fas fa-times"></i> বাতিল
                                </button>
                            </div>
                        </div>
                        <div id="selectedDateDisplay" class="hidden mt-3">
                            <span class="selected-date-display">
                                <i class="fas fa-calendar-check mr-2"></i>
                                নির্বাচিত তারিখ: <span id="selectedDateText"></span>
                            </span>
                            <button onclick="resetToToday()" class="btn btn-warning ml-3">
                                <i class="fas fa-redo"></i> আজকে ফিরে যান
                            </button>
                        </div>
                    </div>

                    <!-- সার্চ বক্স -->
                    <div class="relative mb-6">
                        <input type="text" id="searchInputAttendance" class="search-box" placeholder="ছাত্রের নাম, আইডি, রোল বা শ্রেণি দিয়ে খুঁজুন..." onkeyup="searchStudents('attendance')">
                        <div class="absolute right-6 top-4 text-gray-400">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>

                    <!-- শ্রেণি ফিল্টার -->
                    <div class="mb-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-filter text-blue-500"></i>
                            শ্রেণি অনুযায়ী ফিল্টার
                        </h3>
                        <div class="class-filter-buttons" id="classFiltersAttendance">
                            <!-- ক্লাস ফিল্টার বাটন লোড হবে -->
                        </div>
                    </div>

                    <!-- হাজিরা টেবিল -->
                    <div class="overflow-x-auto">
                        <table>
                            <thead>
                                <tr>
                                    <th>আইডি নং</th>
                                    <th>রোল</th>
                                    <th>নাম</th>
                                    <th class="attendance-column">হাজিরা</th>
                                    <th>শ্রেণি</th>
                                    <th>পিতার নাম</th>
                                    <th>মোবাইল</th>
                                    <th>অ্যাকশন</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTable">
                                <!-- ডেটা লোড হবে -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="noStudents" class="text-center py-12 hidden">
                        <div class="bg-gradient-to-r from-gray-100 to-gray-50 p-8 rounded-2xl inline-block">
                            <i class="fas fa-user-graduate text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-500 mb-2">কোন ছাত্র নেই</h3>
                            <p class="text-gray-400 mb-6">প্রথমে ছাত্র যোগ করুন</p>
                            <button onclick="showAddStudentModal()" class="btn btn-primary">
                                <i class="fas fa-user-plus"></i> ছাত্র যোগ করুন
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Students Page -->
        <div id="students" class="page">
            <div class="max-w-7xl mx-auto">
                <div class="card">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <div class="bg-gradient-to-r from-purple-500 to-pink-500 p-2 rounded-lg">
                                    <i class="fas fa-users text-white"></i>
                                </div>
                                সকল ছাত্র-ছাত্রীর তালিকা
                            </h2>
                            <p class="text-gray-600 text-sm mt-1">মোট ছাত্র: <span id="totalStudentsCount" class="font-bold">০</span></p>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="showAddStudentModal()" class="btn btn-primary">
                                <i class="fas fa-user-plus"></i> নতুন ছাত্র যোগ
                            </button>
                            <button onclick="exportStudents()" class="btn btn-success">
                                <i class="fas fa-download"></i> এক্সপোর্ট
                            </button>
                            <button onclick="showImportModal()" class="btn btn-warning">
                                <i class="fas fa-upload"></i> ইমপোর্ট
                            </button>
                            <button onclick="showBulkDeleteOptions()" class="btn btn-danger pulse-animation">
                                <i class="fas fa-trash-alt"></i> বাল্ক ডিলিট
                            </button>
                        </div>
                    </div>

                    <!-- সার্চ বক্স -->
                    <div class="relative mb-6">
                        <input type="text" id="searchInputStudents" class="search-box" placeholder="ছাত্রের নাম, আইডি, রোল বা শ্রেণি দিয়ে খুঁজুন..." onkeyup="searchStudents('list')">
                        <div class="absolute right-6 top-4 text-gray-400">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>

                    <!-- শ্রেণি ফিল্টার -->
                    <div class="mb-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-filter text-blue-500"></i>
                            শ্রেণি অনুযায়ী ফিল্টার
                        </h3>
                        <div class="class-filter-buttons" id="classFiltersStudents">
                            <!-- ক্লাস ফিল্টার বাটন লোড হবে -->
                        </div>
                    </div>

                    <!-- ছাত্র তালিকা টেবিল -->
                    <div class="overflow-x-auto">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 50px;">
                                        <input type="checkbox" id="selectAllStudents" onclick="toggleSelectAllStudents()">
                                    </th>
                                    <th>আইডি নং</th>
                                    <th>রোল</th>
                                    <th>নাম</th>
                                    <th>শ্রেণি</th>
                                    <th>পিতার নাম</th>
                                    <th>মোবাইল</th>
                                    <th>ঠিকানা</th>
                                    <th>অ্যাকশন</th>
                                </tr>
                            </thead>
                            <tbody id="studentsTable">
                                <!-- ডেটা লোড হবে -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- বাল্ক ডিলিট অপশন -->
                    <div id="bulkDeleteOptions" class="hidden mt-6 p-4 bg-gradient-to-r from-red-50 to-pink-50 rounded-xl border border-red-200">
                        <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                            <div class="flex items-center gap-3">
                                <div class="bg-red-100 p-3 rounded-full">
                                    <i class="fas fa-exclamation-triangle text-red-600"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-red-800">বাল্ক ডিলিট অপশন</h4>
                                    <p class="text-sm text-red-600">আপনি <span id="selectedCount" class="font-bold">0</span> টি ছাত্র নির্বাচন করেছেন</p>
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="cancelBulkDelete()" class="btn bg-gradient-to-r from-gray-500 to-gray-600">
                                    <i class="fas fa-times"></i> বাতিল
                                </button>
                                <button onclick="deleteSelectedStudents()" class="btn btn-danger">
                                    <i class="fas fa-trash-alt"></i> নির্বাচিত ছাত্র ডিলিট করুন
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="noStudentsList" class="text-center py-12 hidden">
                        <div class="bg-gradient-to-r from-gray-100 to-gray-50 p-8 rounded-2xl inline-block">
                            <i class="fas fa-user-graduate text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-500 mb-2">কোন ছাত্র নেই</h3>
                            <p class="text-gray-400 mb-6">প্রথমে ছাত্র যোগ করুন</p>
                            <button onclick="showAddStudentModal()" class="btn btn-primary">
                                <i class="fas fa-user-plus"></i> ছাত্র যোগ করুন
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Page -->
        <div id="reports" class="page">
            <div class="max-w-7xl mx-auto">
                <div class="card">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <div class="bg-gradient-to-r from-green-500 to-emerald-500 p-2 rounded-lg">
                                    <i class="fas fa-chart-line text-white"></i>
                                </div>
                                হাজিরা রিপোর্ট
                            </h2>
                            <p class="text-gray-600 text-sm mt-1">বিভিন্ন ধরনের রিপোর্ট দেখুন ও ডাউনলোড করুন</p>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="exportData()" class="btn btn-success">
                                <i class="fas fa-download"></i> সকল ডেটা
                            </button>
                            <button onclick="showMonthlyReport()" class="btn btn-info">
                                <i class="fas fa-calendar-alt"></i> মাসিক রিপোর্ট
                            </button>
                            <button onclick="showPastDateCorrection()" class="btn btn-warning">
                                <i class="fas fa-edit"></i> অতীত হাজিরা সংশোধন
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Daily Report Card -->
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200 cursor-pointer hover:shadow-lg transition" onclick="showTodayReport()">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="bg-blue-100 p-3 rounded-full">
                                    <i class="fas fa-calendar-day text-blue-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-800">আজকের রিপোর্ট</h3>
                                    <p class="text-sm text-gray-600">দৈনিক হাজিরা বিশ্লেষণ</p>
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-blue-600 mb-2" id="dailyPresentCount">০</div>
                                <div class="text-gray-600">আজ উপস্থিত</div>
                            </div>
                        </div>

                        <!-- Weekly Report Card -->
                        <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200 cursor-pointer hover:shadow-lg transition" onclick="showWeeklyReport()">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="bg-green-100 p-3 rounded-full">
                                    <i class="fas fa-chart-bar text-green-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-800">সাপ্তাহিক রিপোর্ট</h3>
                                    <p class="text-sm text-gray-600">৭ দিনের হাজিরা গ্রাফ</p>
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-green-600 mb-2" id="weeklyAvg">০%</div>
                                <div class="text-gray-600">সাপ্তাহিক গড়</div>
                            </div>
                        </div>

                        <!-- Monthly Report Card -->
                        <div class="bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-xl border border-purple-200 cursor-pointer hover:shadow-lg transition" onclick="showMonthlyReport()">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="bg-purple-100 p-3 rounded-full">
                                    <i class="fas fa-calendar-alt text-purple-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-800">মাসিক রিপোর্ট</h3>
                                    <p class="text-sm text-gray-600">৩০ দিনের হাজিরা বিশ্লেষণ</p>
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-purple-600 mb-2" id="monthlyAvg">০%</div>
                                <div class="text-gray-600">মাসিক গড়</div>
                            </div>
                        </div>

                        <!-- Class-wise Report Card -->
                        <div class="bg-gradient-to-br from-yellow-50 to-amber-50 p-6 rounded-xl border border-yellow-200 cursor-pointer hover:shadow-lg transition" onclick="showClassWiseReport()">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="bg-yellow-100 p-3 rounded-full">
                                    <i class="fas fa-graduation-cap text-yellow-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-800">শ্রেণি অনুযায়ী</h3>
                                    <p class="text-sm text-gray-600">শ্রেণিভিত্তিক হাজিরা</p>
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-yellow-600 mb-2" id="classCount">১২</div>
                                <div class="text-gray-600">মোট শ্রেণি</div>
                            </div>
                        </div>

                        <!-- Student-wise Report Card -->
                        <div class="bg-gradient-to-br from-red-50 to-pink-50 p-6 rounded-xl border border-red-200 cursor-pointer hover:shadow-lg transition" onclick="showStudentReports()">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="bg-red-100 p-3 rounded-full">
                                    <i class="fas fa-user-graduate text-red-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-800">ছাত্র অনুযায়ী</h3>
                                    <p class="text-sm text-gray-600">প্রতিটি ছাত্রের রিপোর্ট</p>
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-red-600 mb-2" id="studentCount">০</div>
                                <div class="text-gray-600">মোট ছাত্র</div>
                            </div>
                        </div>

                        <!-- Export Report Card -->
                        <div class="bg-gradient-to-br from-gray-50 to-slate-50 p-6 rounded-xl border border-gray-200 cursor-pointer hover:shadow-lg transition" onclick="exportData()">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="bg-gray-100 p-3 rounded-full">
                                    <i class="fas fa-file-export text-gray-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-800">ডেটা এক্সপোর্ট</h3>
                                    <p class="text-sm text-gray-600">CSV/Excel ফরম্যাটে</p>
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-gray-600 mb-2">
                                    <i class="fas fa-download"></i>
                                </div>
                                <div class="text-gray-600">ডাউনলোড করুন</div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="mt-8 pt-8 border-t">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">দ্রুত পরিসংখ্যান</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="bg-white p-4 rounded-xl border text-center">
                                <div class="text-2xl font-bold text-blue-600" id="totalPresentDays">০</div>
                                <div class="text-sm text-gray-600">মোট উপস্থিতি দিন</div>
                            </div>
                            <div class="bg-white p-4 rounded-xl border text-center">
                                <div class="text-2xl font-bold text-green-600" id="totalAbsentDays">০</div>
                                <div class="text-sm text-gray-600">মোট অনুপস্থিতি দিন</div>
                            </div>
                            <div class="bg-white p-4 rounded-xl border text-center">
                                <div class="text-2xl font-bold text-purple-600" id="bestAttendance">০%</div>
                                <div class="text-sm text-gray-600">সর্বোচ্চ উপস্থিতি</div>
                            </div>
                            <div class="bg-white p-4 rounded-xl border text-center">
                                <div class="text-2xl font-bold text-red-600" id="worstAttendance">০%</div>
                                <div class="text-sm text-gray-600">সর্বনিম্ন উপস্থিতি</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Classes Page -->
        <div id="classes" class="page">
            <div class="max-w-7xl mx-auto">
                <div class="card">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <div class="bg-gradient-to-r from-yellow-500 to-orange-500 p-2 rounded-lg">
                                    <i class="fas fa-graduation-cap text-white"></i>
                                </div>
                                শ্রেণি ব্যবস্থাপনা
                            </h2>
                            <p class="text-gray-600 text-sm mt-1">শ্রেণি ও শ্রেণি শিক্ষক ব্যবস্থাপনা</p>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="showTeacherManagement()" class="btn btn-warning">
                                <i class="fas fa-chalkboard-teacher"></i> শিক্ষক ব্যবস্থাপনা
                            </button>
                            <button onclick="showAddClassModal()" class="btn btn-primary">
                                <i class="fas fa-plus"></i> নতুন শ্রেণি
                            </button>
                            <button onclick="showClassSheets()" class="btn btn-info">
                                <i class="fas fa-print"></i> হাজিরা সীট
                            </button>
                        </div>
                    </div>

                    <!-- Class Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-gradient-to-br from-amber-50 to-orange-50 p-6 rounded-xl border border-amber-200">
                            <div class="flex items-center gap-4">
                                <div class="bg-amber-100 p-3 rounded-full">
                                    <i class="fas fa-school text-amber-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-800">ইবতেদায়ী</h3>
                                    <p class="text-sm text-gray-600">প্রথম থেকে পঞ্চম শ্রেণি</p>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="text-3xl font-bold text-amber-600" id="ibtidayeeCount">৫</div>
                                <div class="text-gray-600">মোট শ্রেণি</div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-blue-50 to-cyan-50 p-6 rounded-xl border border-blue-200">
                            <div class="flex items-center gap-4">
                                <div class="bg-blue-100 p-3 rounded-full">
                                    <i class="fas fa-university text-blue-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-800">দাখিল</h3>
                                    <p class="text-sm text-gray-600">ষষ্ঠ থেকে দশম শ্রেণি</p>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="text-3xl font-bold text-blue-600" id="dakhilCount">৫</div>
                                <div class="text-gray-600">মোট শ্রেণি</div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-xl border border-purple-200">
                            <div class="flex items-center gap-4">
                                <div class="bg-purple-100 p-3 rounded-full">
                                    <i class="fas fa-user-graduate text-purple-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-800">আলিম</h3>
                                    <p class="text-sm text-gray-600">একাদশ ও দ্বাদশ শ্রেণি</p>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="text-3xl font-bold text-purple-600" id="alimCount">২</div>
                                <div class="text-gray-600">মোট শ্রেণি</div>
                            </div>
                        </div>
                    </div>

                    <!-- All Classes List -->
                    <h3 class="text-lg font-bold text-gray-800 mb-4">সকল শ্রেণির তালিকা</h3>
                    <div class="overflow-x-auto">
                        <table>
                            <thead>
                                <tr>
                                    <th>শ্রেণি</th>
                                    <th>শ্রেণি শিক্ষক</th>
                                    <th>ছাত্র সংখ্যা</th>
                                    <th>আজ উপস্থিত</th>
                                    <th>উপস্থিতি হার</th>
                                    <th>অ্যাকশন</th>
                                </tr>
                            </thead>
                            <tbody id="classesTable">
                                <!-- ডেটা লোড হবে -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings" class="page">
            <div class="max-w-4xl mx-auto">
                <div class="card">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <div class="bg-gradient-to-r from-gray-500 to-slate-500 p-2 rounded-lg">
                                    <i class="fas fa-cog text-white"></i>
                                </div>
                                সেটিংস
                            </h2>
                            <p class="text-gray-600 text-sm mt-1">অ্যাপের সেটিংস কনফিগার করুন</p>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <!-- General Settings -->
                        <div class="bg-gradient-to-r from-gray-50 to-slate-50 p-6 rounded-xl border">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-sliders-h text-blue-500"></i>
                                সাধারণ সেটিংস
                            </h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-medium text-gray-700">বাংলা তারিখ দেখান</div>
                                        <div class="text-sm text-gray-500">সমস্ত তারিখ বাংলা ভাষায় দেখাবে</div>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="banglaDateToggle" checked>
                                        <span class="slider round"></span>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-medium text-gray-700">অটো সেভ</div>
                                        <div class="text-sm text-gray-500">পরিবর্তন গুলি অটোমেটিক সেভ হবে</div>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="autoSaveToggle" checked>
                                        <span class="slider round"></span>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-medium text-gray-700">নোটিফিকেশন</div>
                                        <div class="text-sm text-gray-500">আপডেট ও রিমাইন্ডার নোটিফিকেশন</div>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="notificationToggle" checked>
                                        <span class="slider round"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Data Management -->
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-database text-blue-500"></i>
                                ডেটা ব্যবস্থাপনা
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <button onclick="exportAllData()" class="btn btn-success">
                                    <i class="fas fa-download"></i> সকল ডেটা ব্যাকআপ
                                </button>
                                <button onclick="importData()" class="btn btn-warning">
                                    <i class="fas fa-upload"></i> ডেটা রিস্টোর
                                </button>
                                <button onclick="showDeleteConfirmation('clearData', 'সমস্ত ডেটা ডিলিট করতে চান?', 'clearData')" 
                                        class="btn btn-danger">
                                    <i class="fas fa-trash"></i> সকল ডেটা ডিলিট
                                </button>
                                <button onclick="resetSettings()" class="btn btn-info">
                                    <i class="fas fa-redo"></i> সেটিংস রিসেট
                                </button>
                            </div>
                        </div>

                        <!-- Firebase Settings -->
                        <div class="bg-gradient-to-r from-red-50 to-orange-50 p-6 rounded-xl border">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-fire text-red-500"></i>
                                Firebase সেটিংস
                            </h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-medium text-gray-700">Firebase Sync</div>
                                        <div class="text-sm text-gray-500">রিয়েলটাইম ডেটা সিঙ্ক</div>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="firebaseSyncToggle" checked>
                                        <span class="slider round"></span>
                                    </label>
                                </div>
                                <div class="text-center p-4 bg-gradient-to-r from-red-100 to-orange-100 rounded-lg">
                                    <div class="font-bold text-red-600 mb-2">Firebase Status</div>
                                    <div id="firebaseStatusText" class="text-sm text-gray-600">কানেক্ট হচ্ছে...</div>
                                    <button onclick="checkFirebaseConnection()" class="btn btn-warning mt-3 text-sm">
                                        <i class="fas fa-sync-alt"></i> কানেকশন চেক
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- PWA Settings -->
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-xl border">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-mobile-alt text-purple-500"></i>
                                PWA সেটিংস
                            </h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-medium text-gray-700">অফলাইন মোড</div>
                                        <div class="text-sm text-gray-500">ইন্টারনেট ছাড়া ব্যবহার করুন</div>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="offlineModeToggle" checked>
                                        <span class="slider round"></span>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-medium text-gray-700">সিঙ্ক ডেটা</div>
                                        <div class="text-sm text-gray-500">অনলাইনে গেলে ডেটা সিঙ্ক হবে</div>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="syncDataToggle" checked>
                                        <span class="slider round"></span>
                                    </label>
                                </div>
                                <div class="flex items-center gap-4 mt-6">
                                    <button onclick="addToHomeScreen()" class="btn btn-primary flex-1" id="installButton2">
                                        <i class="fas fa-download"></i> অ্যাপ ইন্সটল
                                    </button>
                                    <button onclick="checkForUpdates()" class="btn btn-info flex-1">
                                        <i class="fas fa-sync-alt"></i> আপডেট চেক
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Contact & Support -->
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-headset text-green-500"></i>
                                যোগাযোগ ও সাপোর্ট
                            </h3>
                            <div class="space-y-4">
                                <div class="flex items-center gap-3 p-4 bg-white rounded-lg border">
                                    <i class="fas fa-phone text-green-600 text-xl"></i>
                                    <div>
                                        <div class="font-bold text-gray-800">সাপোর্ট নম্বর</div>
                                        <div class="text-lg font-bold text-green-600">০১৮১১২৩৬৫৪৮</div>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3 p-4 bg-white rounded-lg border">
                                    <i class="fas fa-envelope text-blue-600 text-xl"></i>
                                    <div>
                                        <div class="font-bold text-gray-800">ইমেইল</div>
                                        <div class="text-lg font-bold text-blue-600">support@madrasa.com</div>
                                    </div>
                                </div>
                                <button onclick="callSupport()" class="btn btn-success w-full">
                                    <i class="fas fa-phone"></i> কল করুন
                                </button>
                            </div>
                        </div>

                        <!-- About App -->
                        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-6 rounded-xl border">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-info-circle text-yellow-500"></i>
                                অ্যাপ সম্পর্কে
                            </h3>
                            <div class="space-y-3 text-gray-600">
                                <div class="flex justify-between">
                                    <span>অ্যাপের নাম:</span>
                                    <span class="font-bold">মাদ্রাসা হাজিরা ব্যবস্থাপনা</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>সংস্করণ:</span>
                                    <span class="font-bold">v2.1.0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>ডেভেলপার:</span>
                                    <span class="font-bold">মেহেরপুর আনছারুল উলূম</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>EIIN:</span>
                                    <span class="font-bold">১৩০২৯০</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>কোড:</span>
                                    <span class="font-bold">১৮৭৫২</span>
                                </div>
                                <div class="pt-4 border-t">
                                    <p class="text-sm">© 2024 মেহেরপুর আনছারুল উলূম আলিম মাদ্রাসা। সর্বস্বত্ব সংরক্ষিত।</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- ছাত্র যোগ/এডিট করার মডেল -->
    <div id="addStudentModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-8 pb-4 border-b">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
                    <div class="bg-gradient-to-r from-blue-500 to-purple-500 p-2 rounded-lg">
                        <i class="fas fa-user-plus text-white"></i>
                    </div>
                    <span id="modalTitle">নতুন ছাত্র যোগ</span>
                </h2>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 p-2 rounded-full hover:bg-gray-100">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                        <i class="fas fa-id-card text-blue-500"></i>
                        ছাত্রের আইডি নং *
                    </label>
                    <input type="text" id="studentId" class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition" 
                           placeholder="যেমন: STD-001">
                    <button type="button" onclick="generateStudentId()" class="btn btn-warning mt-3 text-sm w-full">
                        <i class="fas fa-sync-alt"></i> অটো আইডি জেনারেট করুন
                    </button>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                        <i class="fas fa-sort-numeric-up text-blue-500"></i>
                        রোল নং *
                    </label>
                    <input type="number" id="studentRoll" class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition" 
                           placeholder="যেমন: ১">
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                        <i class="fas fa-user text-blue-500"></i>
                        ছাত্রের নাম *
                    </label>
                    <input type="text" id="studentName" class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition" 
                           placeholder="ছাত্র/ছাত্রীর পূর্ণ নাম লিখুন">
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                        <i class="fas fa-graduation-cap text-blue-500"></i>
                        শ্রেণি *
                    </label>
                    <select id="studentClass" class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition">
                        <option value="">শ্রেণি নির্বাচন করুন</option>
                        <optgroup label="ইবতেদায়ী">
                            <option value="ibtidayee-1">ইবতেদায়ী ১ম শ্রেণি</option>
                            <option value="ibtidayee-2">ইবতেদায়ী ২য় শ্রেণি</option>
                            <option value="ibtidayee-3">ইবতেদায়ী ৩য় শ্রেণি</option>
                            <option value="ibtidayee-4">ইবতেদায়ী ৪র্থ শ্রেণি</option>
                            <option value="ibtidayee-5">ইবতেদায়ী ৫ম শ্রেণি</option>
                        </optgroup>
                        <optgroup label="দাখিল">
                            <option value="dakhil-6">দাখিল ৬ষ্ঠ শ্রেণি</option>
                            <option value="dakhil-7">দাখিল ৭ম শ্রেণি</option>
                            <option value="dakhil-8">দাখিল ৮ম শ্রেণি</option>
                            <option value="dakhil-9">দাখিল ৯ম শ্রেণি</option>
                            <option value="dakhil-10">দাখিল ১০ম শ্রেণি</option>
                        </optgroup>
                        <optgroup label="আলিম">
                            <option value="alim-11">আলিম ১ম বর্ষ</option>
                            <option value="alim-12">আলিম ২য় বর্ষ</option>
                        </optgroup>
                    </select>
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                        <i class="fas fa-user-friends text-blue-500"></i>
                        পিতার নাম *
                    </label>
                    <input type="text" id="studentFather" class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition" 
                           placeholder="পিতার পূর্ণ নাম লিখুন">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                        <i class="fas fa-phone text-blue-500"></i>
                        মোবাইল নম্বর
                    </label>
                    <input type="tel" id="studentMobile" class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition" 
                           placeholder="যেমন: ০১XXXXXXXXX">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                        <i class="fas fa-map-marker-alt text-blue-500"></i>
                        গ্রাম/ঠিকানা
                    </label>
                    <input type="text" id="studentAddress" class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition" 
                           placeholder="গ্রাম/ঠিকানা লিখুন">
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                        <i class="fas fa-sticky-note text-blue-500"></i>
                        বিশেষ মন্তব্য
                    </label>
                    <textarea id="studentNote" class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition" 
                              placeholder="বিশেষ মন্তব্য (যদি থাকে)" rows="2"></textarea>
                </div>
            </div>
            
            <div class="flex flex-col md:flex-row gap-4 pt-8 mt-8 border-t">
                <button onclick="closeModal()" class="btn bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 flex-1">
                    <i class="fas fa-times"></i> বাতিল করুন
                </button>
                <button onclick="confirmAction('saveStudent', 'ছাত্রের তথ্য সংরক্ষণ করতে চান?', 'সংরক্ষণের পর পরিবর্তন করা যাবে।')" 
                        class="btn btn-primary flex-1">
                    <i class="fas fa-save"></i> সংরক্ষণ করুন
                </button>
            </div>
        </div>
    </div>

    <!-- শ্রেণি হাজিরা সীট মডেল -->
    <div id="classSheetsModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-8 pb-4 border-b">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
                    <div class="bg-gradient-to-r from-green-500 to-emerald-500 p-2 rounded-lg">
                        <i class="fas fa-clipboard-list text-white"></i>
                    </div>
                    শ্রেণি হাজিরা সীট
                </h2>
                <button onclick="closeClassSheetsModal()" class="text-gray-500 hover:text-gray-700 p-2 rounded-full hover:bg-gray-100">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                    <i class="fas fa-graduation-cap text-blue-500"></i>
                    শ্রেণি নির্বাচন করুন
                </label>
                <select id="sheetClassSelect" class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition" onchange="loadClassSheet()">
                    <option value="">সব শ্রেণি</option>
                    <optgroup label="ইবতেদায়ী">
                        <option value="ibtidayee-1">ইবতেদায়ী ১ম শ্রেণি</option>
                        <option value="ibtidayee-2">ইবতেদায়ী ২য় শ্রেণি</option>
                        <option value="ibtidayee-3">ইবতেদায়ী ৩য় শ্রেণি</option>
                        <option value="ibtidayee-4">ইবতেদায়ী ৪র্থ শ্রেণি</option>
                        <option value="ibtidayee-5">ইবতেদায়ী ৫ম শ্রেণি</option>
                    </optgroup>
                    <optgroup label="দাখিল">
                        <option value="dakhil-6">দাখিল ৬ষ্ঠ শ্রেণি</option>
                        <option value="dakhil-7">দাখিল ৭ম শ্রেণি</option>
                        <option value="dakhil-8">দাখিল ৮ম শ্রেণি</option>
                        <option value="dakhil-9">দাখিল ৯ম শ্রেণি</option>
                        <option value="dakhil-10">দাখিল ১০ম শ্রেণি</option>
                    </optgroup>
                    <optgroup label="আলিম">
                        <option value="alim-11">আলিম ১ম বর্ষ</option>
                        <option value="alim-12">আলিম ২য় বর্ষ</option>
                    </optgroup>
                </select>
            </div>
            
            <div class="flex gap-4 mb-6">
                <button onclick="printClassSheet()" class="btn btn-primary flex-1">
                    <i class="fas fa-print"></i> প্রিন্ট করুন
                </button>
                <button onclick="exportClassSheet()" class="btn btn-success flex-1">
                    <i class="fas fa-download"></i> ডাউনলোড করুন
                </button>
                <button onclick="showPastDateForClassSheet()" class="btn btn-warning flex-1">
                    <i class="fas fa-calendar-alt"></i> অতীত তারিখ
                </button>
            </div>
            
            <div id="classSheetContent">
                <!-- শ্রেণি সীট কন্টেন্ট লোড হবে -->
            </div>
        </div>
    </div>

    <!-- শিক্ষক ব্যবস্থাপনা মডেল -->
    <div id="teacherManagementModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-8 pb-4 border-b">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
                    <div class="bg-gradient-to-r from-yellow-500 to-orange-500 p-2 rounded-lg">
                        <i class="fas fa-chalkboard-teacher text-white"></i>
                    </div>
                    শ্রেণি শিক্ষক ব্যবস্থাপনা
                </h2>
                <button onclick="closeTeacherModal()" class="text-gray-500 hover:text-gray-700 p-2 rounded-full hover:bg-gray-100">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-xl mb-4">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-info-circle text-blue-500 text-xl"></i>
                        <div>
                            <h4 class="font-bold text-blue-700">নির্দেশনা:</h4>
                            <p class="text-blue-600 text-sm">প্রতিটি শ্রেণির জন্য শ্রেণি শিক্ষকের নাম নির্ধারণ করুন। এই নামগুলো হাজিরা সীটে প্রদর্শিত হবে।</p>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ইবতেদায়ী শ্রেণিসমূহ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="ibtidayeeTeachers">
                        <!-- ইবতেদায়ী শ্রেণি শিক্ষক ইনপুট -->
                    </div>
                    
                    <h3 class="text-lg font-bold text-gray-800 mb-4 mt-6">দাখিল শ্রেণিসমূহ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="dakhilTeachers">
                        <!-- দাখিল শ্রেণি শিক্ষক ইনপুট -->
                    </div>
                    
                    <h3 class="text-lg font-bold text-gray-800 mb-4 mt-6">আলিম শ্রেণিসমূহ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="alimTeachers">
                        <!-- আলিম শ্রেণি শিক্ষক ইনপুট -->
                    </div>
                </div>
            </div>
            
            <div class="flex flex-col md:flex-row gap-4 pt-8 mt-8 border-t">
                <button onclick="closeTeacherModal()" class="btn bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 flex-1">
                    <i class="fas fa-times"></i> বাতিল করুন
                </button>
                <button onclick="saveTeachers()" class="btn btn-primary flex-1">
                    <i class="fas fa-save"></i> সংরক্ষণ করুন
                </button>
            </div>
        </div>
    </div>

    <!-- রিপোর্ট মডেল -->
    <div id="reportModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-8 pb-4 border-b">
                <h2 class="text-2xl font-bold text-gray-800" id="reportTitle"></h2>
                <button onclick="closeReportModal()" class="text-gray-500 hover:text-gray-700 p-2 rounded-full hover:bg-gray-100">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <div id="reportContent">
                <!-- রিপোর্ট কন্টেন্ট লোড হবে -->
            </div>
        </div>
    </div>

    <!-- কনফার্মেশন মডেল -->
    <div id="confirmationModal" class="confirmation-modal hidden">
        <div class="confirmation-content">
            <div class="bg-gradient-to-r from-yellow-100 to-orange-50 p-6 rounded-xl mb-6">
                <i class="fas fa-exclamation-triangle text-5xl text-yellow-500 mb-4"></i>
                <h3 class="text-xl font-bold text-gray-800 mb-2" id="confirmationTitle"></h3>
                <p class="text-gray-600" id="confirmationMessage"></p>
            </div>
            <div class="confirmation-buttons">
                <button onclick="cancelAction()" class="btn bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 flex-1">
                    <i class="fas fa-times"></i> না, বাতিল করুন
                </button>
                <button onclick="proceedAction()" class="btn btn-danger flex-1">
                    <i class="fas fa-check"></i> হ্যাঁ, নিশ্চিত
                </button>
            </div>
        </div>
    </div>

    <!-- উন্নত ডিলিট কনফার্মেশন মডেল -->
    <div id="deleteConfirmationModal" class="delete-confirmation-modal hidden">
        <div class="delete-confirmation-content">
            <div class="delete-icon">
                <i class="fas fa-trash-alt"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-4" id="deleteTitle">ছাত্র ডিলিট করবেন?</h2>
            <p class="text-gray-600 mb-6" id="deleteMessage">আপনি কি নিশ্চিত যে এই ছাত্রকে ডিলিট করতে চান?</p>
            
            <!-- ছাত্রের তথ্য -->
            <div class="delete-student-info" id="deleteStudentInfo">
                <!-- ছাত্রের তথ্য এখানে লোড হবে -->
            </div>
            
            <!-- সতর্কবার্তা -->
            <div class="delete-warning">
                <div class="delete-warning-title">
                    <i class="fas fa-exclamation-triangle delete-warning-icon"></i>
                    <span>সতর্কতা!</span>
                </div>
                <ul class="delete-warning-list">
                    <li>
                        <i class="fas fa-times-circle"></i>
                        <span>ডিলিটের পর ছাত্রের সকল তথ্য মুছে যাবে</span>
                    </li>
                    <li>
                        <i class="fas fa-calendar-times"></i>
                        <span>ছাত্রের সকল হাজিরা রেকর্ড ডিলিট হবে</span>
                    </li>
                    <li>
                        <i class="fas fa-history"></i>
                        <span>এই কাজটি পূর্বাবস্থায় ফেরানো যাবে না</span>
                    </li>
                </ul>
            </div>
            
            <div class="delete-buttons">
                <button onclick="cancelDelete()" class="delete-btn delete-cancel-btn">
                    <i class="fas fa-times"></i> বাতিল করুন
                </button>
                <button onclick="confirmDelete()" class="delete-btn delete-confirm-btn">
                    <i class="fas fa-trash-alt"></i> হ্যাঁ, ডিলিট করুন
                </button>
            </div>
        </div>
    </div>

    <!-- অতীত তারিখের হাজিরা সংশোধনের মডেল -->
    <div id="pastDateCorrectionModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-8 pb-4 border-b">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
                    <div class="bg-gradient-to-r from-orange-500 to-red-500 p-2 rounded-lg">
                        <i class="fas fa-calendar-edit text-white"></i>
                    </div>
                    অতীত তারিখের হাজিরা সংশোধন
                </h2>
                <button onclick="closePastDateCorrectionModal()" class="text-gray-500 hover:text-gray-700 p-2 rounded-full hover:bg-gray-100">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                    <i class="fas fa-calendar-day text-blue-500"></i>
                    তারিখ নির্বাচন করুন
                </label>
                <div class="flex gap-4">
                    <input type="date" id="correctionDateInput" class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition">
                    <button onclick="loadDateForCorrection()" class="btn btn-primary whitespace-nowrap">
                        <i class="fas fa-search"></i> হাজিরা দেখুন
                    </button>
                </div>
            </div>
            
            <div id="dateCorrectionContent">
                <div class="text-center py-12 text-gray-500">
                    <i class="fas fa-calendar-alt text-4xl mb-4"></i>
                    <div class="text-xl">তারিখ নির্বাচন করুন</div>
                    <div class="text-sm mt-2">একটি তারিখ নির্বাচন করে হাজিরা দেখুন এবং সংশোধন করুন</div>
                </div>
            </div>
        </div>
    </div>

    <!-- PWA ইনস্টল প্রম্পট -->
    <div id="pwaInstallPrompt" class="pwa-install-prompt">
        <div class="pwa-install-prompt-content">
            <div class="pwa-install-prompt-title">📱 অ্যাপ ইন্সটল করুন</div>
            <div class="pwa-install-prompt-description">অফলাইনে ব্যবহারের জন্য অ্যাপটি আপনার হোম স্ক্রীনে যোগ করুন</div>
        </div>
        <div class="pwa-install-buttons">
            <button id="pwaInstallCancel" class="pwa-install-btn pwa-install-secondary">না</button>
            <button id="pwaInstallConfirm" class="pwa-install-btn pwa-install-primary">ইন্সটল</button>
        </div>
    </div>

    <!-- নেটওয়ার্ক স্ট্যাটাস ইন্ডিকেটর -->
    <div id="offlineIndicator" class="offline-indicator">
        <i class="fas fa-wifi-slash"></i>
        <span>অফলাইন মোড</span>
    </div>

    <div id="onlineIndicator" class="online-indicator">
        <i class="fas fa-wifi"></i>
        <span>অনলাইনে ফিরে এসেছেন</span>
    </div>

    <div id="syncIndicator" class="sync-indicator">
        <i class="fas fa-sync-alt fa-spin"></i>
        <span>ডেটা সিঙ্ক হচ্ছে...</span>
    </div>

    <!-- টোয়াস্ট মেসেজ -->
    <div id="toast" class="toast hidden">
        <i class="fas fa-check-circle text-xl"></i>
        <span id="toastMessage"></span>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC3X3RdFHc0TBBn1c00deQfP9ewmdz1GfQ",
            authDomain: "madrasa-attendance-b9311.firebaseapp.com",
            projectId: "madrasa-attendance-b9311",
            storageBucket: "madrasa-attendance-b9311.firebasestorage.app",
            messagingSenderId: "927862270858",
            appId: "1:927862270858:web:cb3fe5b4bfdfe898f67673",
            measurementId: "G-74VJ1FQT08"
        };

        // Initialize Firebase
        let firebaseApp;
        let db;
        let firebaseInitialized = false;
        let isFirebaseConnected = false;

        // Firebase Collections
        const STUDENTS_COLLECTION = "students";
        const ATTENDANCE_COLLECTION = "attendance";
        const TEACHERS_COLLECTION = "teachers";
        const SETTINGS_COLLECTION = "settings";

        // PWA Variables
        let deferredPrompt;
        let isPWAInstalled = false;
        
        // ডেটা স্টোরেজ
        let students = [];
        let attendance = [];
        let teachers = {}; // শ্রেণি শিক্ষকদের তথ্য
        let currentStudentId = null;
        let pendingAction = null;
        let currentFilterClass = '';
        let confirmationData = null;
        let selectedStudents = new Set(); // বাল্ক ডিলিটের জন্য নির্বাচিত ছাত্র আইডি
        let deleteType = ''; // ডিলিটের ধরন (single, bulk, clearData)
        let deleteStudentData = null; // ডিলিট করা ছাত্রের তথ্য
        
        // অতীত তারিখের হাজিরা ভ্যারিয়েবল
        let selectedPastDate = null; // নির্বাচিত অতীত তারিখ
        let isPastDateMode = false; // অতীত তারিখ মোড চালু আছে কিনা
        
        // Navigation Variables
        let currentPage = 'dashboard';
        
        // বাংলা তারিখ
        const banglaMonths = [
            'জানুয়ারী', 'ফেব্রুয়ারী', 'মার্চ', 'এপ্রিল', 'মে', 'জুন',
            'জুলাই', 'আগস্ট', 'সেপ্টেম্বর', 'অক্টোবর', 'নভেম্বর', 'ডিসেম্বর'
        ];
        
        const banglaDays = [
            'রবিবার', 'সোমবার', 'মঙ্গলবার', 'বুধবার', 'বৃহস্পতিবার', 'শুক্রবার', 'শনিবার'
        ];

        // বাংলা সংখ্যা
        const banglaNumbers = ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'];
        
        function toBangla(num) {
            if (num === undefined || num === null) return '০';
            return num.toString().split('').map(digit => {
                if (digit >= '0' && digit <= '9') {
                    return banglaNumbers[parseInt(digit)];
                }
                return digit;
            }).join('');
        }

        // বাংলা তারিখে রূপান্তর
        function toBanglaDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const day = banglaDays[date.getDay()];
            const dayNum = toBangla(date.getDate());
            const month = banglaMonths[date.getMonth()];
            const year = toBangla(date.getFullYear());
            
            return `${day}, ${dayNum} ${month} ${year}`;
        }

        // তারিখ স্ট্রিং থেকে বাংলা তারিখ
        function getBanglaDateFromString(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const dayNum = toBangla(date.getDate());
            const month = banglaMonths[date.getMonth()];
            const year = toBangla(date.getFullYear());
            
            return `${dayNum} ${month} ${year}`;
        }

        // Initialize Firebase
        function initializeFirebase() {
            try {
                firebaseApp = firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                firebaseInitialized = true;
                
                // Enable offline persistence
                db.enablePersistence()
                    .then(() => {
                        console.log("Firebase persistence enabled");
                    })
                    .catch((err) => {
                        console.log("Firebase persistence error: ", err);
                    });
                
                // Monitor connection status
                db.collection(STUDENTS_COLLECTION).onSnapshot(
                    () => {
                        updateFirebaseStatus(true);
                    },
                    (error) => {
                        updateFirebaseStatus(false);
                        console.error("Firebase error: ", error);
                    }
                );
                
                // Load initial data from Firebase
                loadFirebaseData();
                
                // Listen for real-time updates
                setupFirebaseListeners();
                
            } catch (error) {
                console.error("Firebase initialization error: ", error);
                updateFirebaseStatus(false);
                // Load from local storage if Firebase fails
                loadDataFromLocal();
            }
        }

        function updateFirebaseStatus(connected) {
            isFirebaseConnected = connected;
            const statusElement = document.getElementById('firebaseStatus');
            const statusText = document.getElementById('firebaseStatusText');
            const badge = document.getElementById('firebaseBadge');
            
            if (connected) {
                statusElement.className = 'firebase-status firebase-connected';
                statusElement.innerHTML = '<i class="fas fa-check-circle"></i><span>ফায়ারবেস সংযুক্ত</span>';
                statusElement.classList.remove('hidden');
                
                if (statusText) {
                    statusText.textContent = 'ফায়ারবেস সংযুক্ত - রিয়েলটাইম সিঙ্ক সক্রিয়';
                }
                
                if (badge) {
                    badge.className = 'badge badge-success';
                    badge.innerHTML = '<i class="fas fa-database"></i> ফায়ারবেস';
                    badge.classList.remove('hidden');
                }
                
                showToast('ফায়ারবেস সংযুক্ত!', 'success');
            } else {
                statusElement.className = 'firebase-status firebase-disconnected';
                statusElement.innerHTML = '<i class="fas fa-times-circle"></i><span>ফায়ারবেস সংযোগ নেই</span>';
                statusElement.classList.remove('hidden');
                
                if (statusText) {
                    statusText.textContent = 'ফায়ারবেস সংযোগ নেই - লোকাল ডেটা ব্যবহার হচ্ছে';
                }
                
                if (badge) {
                    badge.className = 'badge badge-warning';
                    badge.innerHTML = '<i class="fas fa-database"></i> লোকাল';
                    badge.classList.remove('hidden');
                }
            }
        }

        function setupFirebaseListeners() {
            // Listen for students changes
            db.collection(STUDENTS_COLLECTION).onSnapshot((snapshot) => {
                const newStudents = [];
                snapshot.forEach((doc) => {
                    newStudents.push({ id: doc.id, ...doc.data() });
                });
                students = newStudents;
                saveToLocal('students', students);
                updateUI();
            });

            // Listen for attendance changes
            db.collection(ATTENDANCE_COLLECTION).onSnapshot((snapshot) => {
                const newAttendance = [];
                snapshot.forEach((doc) => {
                    newAttendance.push({ id: doc.id, ...doc.data() });
                });
                attendance = newAttendance;
                saveToLocal('attendance', attendance);
                updateUI();
            });

            // Listen for teachers changes
            db.collection(TEACHERS_COLLECTION).doc('classTeachers').onSnapshot((doc) => {
                if (doc.exists) {
                    teachers = doc.data();
                    saveToLocal('teachers', teachers);
                    updateUI();
                }
            });

            // Listen for settings changes
            db.collection(SETTINGS_COLLECTION).doc('appSettings').onSnapshot((doc) => {
                if (doc.exists) {
                    const settings = doc.data();
                    applySettings(settings);
                    saveToLocal('settings', settings);
                }
            });
        }

        function loadFirebaseData() {
            // Load students
            db.collection(STUDENTS_COLLECTION).get().then((snapshot) => {
                students = [];
                snapshot.forEach((doc) => {
                    students.push({ id: doc.id, ...doc.data() });
                });
                saveToLocal('students', students);
                updateUI();
            });

            // Load attendance
            db.collection(ATTENDANCE_COLLECTION).get().then((snapshot) => {
                attendance = [];
                snapshot.forEach((doc) => {
                    attendance.push({ id: doc.id, ...doc.data() });
                });
                saveToLocal('attendance', attendance);
                updateUI();
            });

            // Load teachers
            db.collection(TEACHERS_COLLECTION).doc('classTeachers').get().then((doc) => {
                if (doc.exists) {
                    teachers = doc.data();
                    saveToLocal('teachers', teachers);
                    updateUI();
                }
            });

            // Load settings
            db.collection(SETTINGS_COLLECTION).doc('appSettings').get().then((doc) => {
                if (doc.exists) {
                    const settings = doc.data();
                    applySettings(settings);
                    saveToLocal('settings', settings);
                }
            });
        }

        function loadDataFromLocal() {
            const savedStudents = localStorage.getItem('madrasaStudents');
            if (savedStudents) {
                students = JSON.parse(savedStudents);
            } else {
                // Sample data for testing
                students = [
                    {
                        id: 'STD-001',
                        roll: 1,
                        name: 'আহমেদ হাসান',
                        class: 'dakhil-6',
                        father: 'মোঃ করিম উদ্দিন',
                        mobile: '01811236548',
                        address: 'মেহেরপুর সদর',
                        note: 'সরকারি স্কলারশিপ প্রাপ্ত'
                    },
                    {
                        id: 'STD-002',
                        roll: 2,
                        name: 'ফাতেমা আক্তার',
                        class: 'dakhil-6',
                        father: 'মোঃ সোলাইমান',
                        mobile: '01712345678',
                        address: 'মেহেরপুর সদর',
                        note: ''
                    }
                ];
            }
            
            const savedAttendance = localStorage.getItem('madrasaAttendance');
            if (savedAttendance) {
                attendance = JSON.parse(savedAttendance);
            }
            
            const savedTeachers = localStorage.getItem('madrasaTeachers');
            if (savedTeachers) {
                teachers = JSON.parse(savedTeachers);
            } else {
                // Default teachers
                teachers = {
                    'ibtidayee-1': 'মোঃ আব্দুল করিম',
                    'ibtidayee-2': 'মোঃ সোলাইমান আলী',
                    'ibtidayee-3': 'মোঃ হারুন অর রশিদ',
                    'ibtidayee-4': 'মোসাঃ ফাতেমা খাতুন',
                    'ibtidayee-5': 'মোঃ রফিকুল ইসলাম',
                    'dakhil-6': 'মোঃ শহীদুল ইসলাম',
                    'dakhil-7': 'মোসাঃ আয়েশা সিদ্দিকা',
                    'dakhil-8': 'মোঃ জামাল উদ্দিন',
                    'dakhil-9': 'মোঃ নুরুল আমিন',
                    'dakhil-10': 'মোসাঃ সেলিনা আক্তার',
                    'alim-11': 'মোঃ আজিজুর রহমান',
                    'alim-12': 'মোসাঃ রুবিনা বেগম'
                };
            }
            
            updateUI();
        }

        function saveToLocal(key, data) {
            localStorage.setItem(`madrasa${key.charAt(0).toUpperCase() + key.slice(1)}`, JSON.stringify(data));
        }

        function saveStudentToFirebase(studentData) {
            if (!firebaseInitialized) {
                saveToLocal('students', students);
                return;
            }
            
            const studentRef = db.collection(STUDENTS_COLLECTION).doc(studentData.id);
            studentRef.set(studentData)
                .then(() => {
                    console.log("Student saved to Firebase");
                })
                .catch((error) => {
                    console.error("Error saving student: ", error);
                    saveToLocal('students', students);
                });
        }

        function saveAttendanceToFirebase(attendanceData) {
            if (!firebaseInitialized) {
                saveToLocal('attendance', attendance);
                return;
            }
            
            const attendanceRef = db.collection(ATTENDANCE_COLLECTION).doc(attendanceData.id);
            attendanceRef.set(attendanceData)
                .then(() => {
                    console.log("Attendance saved to Firebase");
                })
                .catch((error) => {
                    console.error("Error saving attendance: ", error);
                    saveToLocal('attendance', attendance);
                });
        }

        function saveTeachersToFirebase() {
            if (!firebaseInitialized) {
                saveToLocal('teachers', teachers);
                return;
            }
            
            const teachersRef = db.collection(TEACHERS_COLLECTION).doc('classTeachers');
            teachersRef.set(teachers)
                .then(() => {
                    console.log("Teachers saved to Firebase");
                })
                .catch((error) => {
                    console.error("Error saving teachers: ", error);
                    saveToLocal('teachers', teachers);
                });
        }

        function deleteStudentFromFirebase(studentId) {
            if (!firebaseInitialized) {
                saveToLocal('students', students);
                return;
            }
            
            // Delete student document
            db.collection(STUDENTS_COLLECTION).doc(studentId).delete()
                .then(() => {
                    console.log("Student deleted from Firebase");
                })
                .catch((error) => {
                    console.error("Error deleting student: ", error);
                    saveToLocal('students', students);
                });
            
            // Delete associated attendance records
            db.collection(ATTENDANCE_COLLECTION).where('studentId', '==', studentId).get()
                .then((snapshot) => {
                    snapshot.forEach((doc) => {
                        doc.ref.delete();
                    });
                    console.log("Attendance records deleted from Firebase");
                })
                .catch((error) => {
                    console.error("Error deleting attendance records: ", error);
                });
        }

        function checkFirebaseConnection() {
            if (firebaseInitialized && isFirebaseConnected) {
                showToast('ফায়ারবেস সংযুক্ত আছে!', 'success');
            } else {
                showToast('ফায়ারবেস সংযোগ নেই। লোকাল ডেটা ব্যবহার হচ্ছে।', 'warning');
            }
        }

        // Navigation Functions
        function navigateToPage(pageId) {
            showPage(pageId);
            toggleMobileMenu();
        }

        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update active nav link in mobile menu
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                
                // Get the page name from the link text
                const linkText = link.textContent.trim();
                const pageName = getPageName(pageId);
                
                // Check if this link corresponds to the current page
                if (linkText.includes(pageName)) {
                    link.classList.add('active');
                }
            });
            
            // Update current page
            currentPage = pageId;
            
            // Load page specific data
            loadPageData(pageId);
        }
        
        function getPageName(pageId) {
            const pageNames = {
                'dashboard': 'ড্যাশবোর্ড',
                'attendance': 'হাজিরা',
                'students': 'ছাত্র তালিকা',
                'reports': 'রিপোর্ট',
                'classes': 'শ্রেণি ব্যবস্থাপনা',
                'settings': 'সেটিংস'
            };
            return pageNames[pageId] || pageId;
        }
        
        function loadPageData(pageId) {
            switch(pageId) {
                case 'dashboard':
                    updateDashboard();
                    renderWeeklyReport();
                    break;
                case 'attendance':
                    renderClassFilters('attendance');
                    renderAttendanceTable();
                    break;
                case 'students':
                    renderClassFilters('students');
                    renderStudentsTable();
                    break;
                case 'reports':
                    loadReportStats();
                    break;
                case 'classes':
                    loadClassesTable();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }
        
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('show');
        }

        // PWA Functions
        function checkPWAStatus() {
            // Check if app is installed
            isPWAInstalled = window.matchMedia('(display-mode: standalone)').matches || 
                            window.navigator.standalone === true ||
                            localStorage.getItem('pwaInstalled') === 'true';
            
            if (isPWAInstalled) {
                document.getElementById('pwaStatus').innerHTML = '<i class="fas fa-check-circle"></i> PWA ইন্সটলড';
                document.getElementById('pwaStatus').className = 'badge badge-success';
                document.getElementById('installButton').classList.add('hidden');
                document.getElementById('installButton2').classList.add('hidden');
            } else {
                document.getElementById('pwaStatus').innerHTML = '<i class="fas fa-mobile-alt"></i> PWA';
                document.getElementById('pwaStatus').className = 'badge badge-warning';
                document.getElementById('installButton').classList.remove('hidden');
                document.getElementById('installButton2').classList.remove('hidden');
            }
        }

        // শ্রেণি লেবেল
        function getClassLabel(classValue) {
            const classMap = {
                'ibtidayee-1': {label: 'ইবতেদায়ী ১ম', badge: 'class-ibtidayee'},
                'ibtidayee-2': {label: 'ইবতেদায়ী ২য়', badge: 'class-ibtidayee'},
                'ibtidayee-3': {label: 'ইবতেদায়ী ৩য়', badge: 'class-ibtidayee'},
                'ibtidayee-4': {label: 'ইবতেদায়ী ৪র্থ', badge: 'class-ibtidayee'},
                'ibtidayee-5': {label: 'ইবতেদায়ী ৫ম', badge: 'class-ibtidayee'},
                'dakhil-6': {label: 'দাখিল ৬ষ্ঠ', badge: 'class-dakhil'},
                'dakhil-7': {label: 'দাখিল ৭ম', badge: 'class-dakhil'},
                'dakhil-8': {label: 'দাখিল ৮ম', badge: 'class-dakhil'},
                'dakhil-9': {label: 'দাখিল ৯ম', badge: 'class-dakhil'},
                'dakhil-10': {label: 'দাখিল ১০ম', badge: 'class-dakhil'},
                'alim-11': {label: 'আলিম ১ম বর্ষ', badge: 'class-alim'},
                'alim-12': {label: 'আলিম ২য় বর্ষ', badge: 'class-alim'}
            };
            
            return classMap[classValue] || {label: classValue, badge: ''};
        }

        // শ্রেণি শিক্ষকের নাম পাওয়া
        function getClassTeacher(classValue) {
            return teachers[classValue] || 'শ্রেণি শিক্ষক: নির্ধারণ করুন';
        }

        // তারিখ আপডেট
        function updateDate() {
            const now = new Date();
            const day = banglaDays[now.getDay()];
            const date = now.getDate();
            const month = banglaMonths[now.getMonth()];
            const year = now.getFullYear();
            
            document.getElementById('currentDate').innerHTML = 
                `<i class="fas fa-calendar-day"></i> আজ: ${day}, ${toBangla(date)} ${month} ${toBangla(year)}`;
            
            document.getElementById('todayDate2').textContent = 
                `${toBangla(date)} ${month} ${toBangla(year)}`;
            
            setTimeout(updateDate, 60000);
        }

        function updateUI() {
            updateDashboard();
            if (currentPage === 'attendance') {
                renderClassFilters('attendance');
                if (isPastDateMode && selectedPastDate) {
                    renderAttendanceTableForDate(selectedPastDate);
                } else {
                    renderAttendanceTable();
                }
            } else if (currentPage === 'students') {
                renderClassFilters('students');
                renderStudentsTable();
            } else if (currentPage === 'dashboard') {
                renderWeeklyReport();
            } else if (currentPage === 'classes') {
                loadClassesTable();
            } else if (currentPage === 'reports') {
                loadReportStats();
            }
        }

        // শ্রেণি ফিল্টার রেন্ডার
        function renderClassFilters(page = 'attendance') {
            const containerId = page === 'attendance' ? 'classFiltersAttendance' : 'classFiltersStudents';
            const container = document.getElementById(containerId);
            if (!container) return;
            
            let html = '';
            
            const classes = [
                {value: '', label: 'সব শ্রেণি', color: 'from-blue-500 to-purple-500'},
                {value: 'ibtidayee-1', label: 'ইবতেদায়ী ১ম', color: 'from-amber-500 to-orange-500'},
                {value: 'ibtidayee-2', label: 'ইবতেদায়ী ২য়', color: 'from-amber-500 to-orange-500'},
                {value: 'ibtidayee-3', label: 'ইবতেদায়ী ৩য়', color: 'from-amber-500 to-orange-500'},
                {value: 'ibtidayee-4', label: 'ইবতেদায়ী ৪র্থ', color: 'from-amber-500 to-orange-500'},
                {value: 'ibtidayee-5', label: 'ইবতেদায়ী ৫ম', color: 'from-amber-500 to-orange-500'},
                {value: 'dakhil-6', label: 'দাখিল ৬ষ্ঠ', color: 'from-blue-500 to-cyan-500'},
                {value: 'dakhil-7', label: 'দাখিল ৭ম', color: 'from-blue-500 to-cyan-500'},
                {value: 'dakhil-8', label: 'দাখিল ৮ম', color: 'from-blue-500 to-cyan-500'},
                {value: 'dakhil-9', label: 'দাখিল ৯ম', color: 'from-blue-500 to-cyan-500'},
                {value: 'dakhil-10', label: 'দাখিল ১০ম', color: 'from-blue-500 to-cyan-500'},
                {value: 'alim-11', label: 'আলিম ১ম বর্ষ', color: 'from-purple-500 to-pink-500'},
                {value: 'alim-12', label: 'আলিম ২য় বর্ষ', color: 'from-purple-500 to-pink-500'}
            ];
            
            classes.forEach(cls => {
                const isActive = currentFilterClass === cls.value;
                const count = cls.value ? students.filter(s => s.class === cls.value).length : students.length;
                const teacherName = cls.value ? getClassTeacher(cls.value) : '';
                
                html += `
                    <button onclick="filterByClass('${cls.value}', '${page}')" 
                            class="class-filter-btn ${isActive ? 'active' : ''}">
                        <div class="text-left">
                            <div class="font-bold">${cls.label}</div>
                            <div class="text-xs ${teacherName ? 'text-purple-600 font-semibold' : 'text-gray-500'}">
                                ${teacherName}
                            </div>
                        </div>
                        <div class="text-xs bg-gray-100 px-2 py-1 rounded">${toBangla(count)}</div>
                    </button>
                `;
            });
            
            container.innerHTML = html;
        }

        // শ্রেণি অনুযায়ী ফিল্টার
        function filterByClass(className, page = 'attendance') {
            currentFilterClass = className;
            
            if (page === 'attendance') {
                renderClassFilters('attendance');
                if (isPastDateMode && selectedPastDate) {
                    renderAttendanceTableForDate(selectedPastDate);
                } else {
                    renderAttendanceTable();
                }
            } else {
                renderClassFilters('students');
                renderStudentsTable();
            }
        }

        // ড্যাশবোর্ড আপডেট
        function updateDashboard() {
            const today = new Date().toDateString();
            const todayAttendance = attendance.filter(a => a.date === today);
            
            let present = 0;
            let absent = 0;
            
            students.forEach(student => {
                const studentAttendance = todayAttendance.find(a => a.studentId === student.id);
                if (studentAttendance && studentAttendance.status === 'present') {
                    present++;
                } else {
                    absent++;
                }
            });
            
            const total = students.length;
            const rate = total > 0 ? Math.round((present / total) * 100) : 0;
            
            document.getElementById('presentCount').textContent = toBangla(present);
            document.getElementById('absentCount').textContent = toBangla(absent);
            document.getElementById('totalCount').textContent = toBangla(total);
            document.getElementById('attendanceRate').textContent = toBangla(rate) + '%';
        }

        // হাজিরা টেবিল রেন্ডার (বর্তমান তারিখের জন্য)
        function renderAttendanceTable() {
            const today = new Date().toDateString();
            renderAttendanceTableForDate(today);
        }

        // নির্দিষ্ট তারিখের জন্য হাজিরা টেবিল রেন্ডার
        function renderAttendanceTableForDate(dateString) {
            const table = document.getElementById('attendanceTable');
            const noStudents = document.getElementById('noStudents');
            
            let filteredStudents = students;
            
            if (currentFilterClass) {
                filteredStudents = students.filter(student => student.class === currentFilterClass);
            }
            
            if (filteredStudents.length === 0) {
                table.innerHTML = '';
                noStudents.classList.remove('hidden');
                return;
            }
            
            noStudents.classList.add('hidden');
            
            const banglaDate = toBanglaDate(dateString);
            const isToday = dateString === new Date().toDateString();
            
            // হেডারে তারিখ আপডেট করুন
            if (isPastDateMode && selectedPastDate) {
                document.getElementById('todayDate2').textContent = banglaDate + ' (অতীত তারিখ)';
                document.getElementById('todayDate2').className = 'text-orange-600';
            } else if (isToday) {
                document.getElementById('todayDate2').textContent = banglaDate;
                document.getElementById('todayDate2').className = 'text-blue-600';
            } else {
                document.getElementById('todayDate2').textContent = banglaDate + ' (অতীত তারিখ)';
                document.getElementById('todayDate2').className = 'text-orange-600';
            }
            
            let html = '';
            
            filteredStudents.forEach((student, index) => {
                const studentAttendance = attendance.find(a => 
                    a.studentId === student.id && a.date === dateString
                );
                
                const status = studentAttendance ? studentAttendance.status : 'absent';
                const classInfo = getClassLabel(student.class);
                const teacherName = getClassTeacher(student.class);
                
                html += `
                    <tr class="${status === 'present' ? 'status-present' : 'status-absent'}">
                        <td><span class="font-bold bg-gray-100 px-3 py-1 rounded-lg">${student.id || 'N/A'}</span></td>
                        <td><span class="font-bold text-gray-800">${toBangla(student.roll)}</span></td>
                        <td>
                            <div class="font-bold text-gray-800">${student.name}</div>
                            <div class="text-xs text-gray-500 mt-1">${student.father}</div>
                        </td>
                        <td class="attendance-column">
                            <div class="flex flex-col md:flex-row gap-2">
                                <button onclick="markAttendanceForDate('${student.id}', 'present', '${dateString}')" 
                                        class="attendance-btn ${status === 'present' ? 'bg-green-500 text-white border-green-500' : 'bg-white text-green-500 border-green-500'}">
                                    <i class="fas fa-check"></i> উপস্থিত
                                </button>
                                <button onclick="markAttendanceForDate('${student.id}', 'absent', '${dateString}')" 
                                        class="attendance-btn ${status === 'absent' ? 'bg-red-500 text-white border-red-500' : 'bg-white text-red-500 border-red-500'}">
                                    <i class="fas fa-times"></i> অনুপস্থিত
                                </button>
                            </div>
                            <div class="text-xs mt-2 text-center ${status === 'present' ? 'text-green-600 font-bold' : 'text-red-600 font-bold'}">
                                ${status === 'present' ? '✓ উপস্থিত' : '✗ অনুপস্থিত'}
                            </div>
                        </td>
                        <td>
                            <div>
                                <span class="${classInfo.badge} class-badge">${classInfo.label}</span>
                                <div class="text-xs text-purple-600 font-semibold mt-1">${teacherName}</div>
                            </div>
                        </td>
                        <td>${student.father}</td>
                        <td>
                            ${student.mobile ? 
                                `<div class="flex items-center gap-2">
                                    <i class="fas fa-phone text-green-500"></i>
                                    <span>${student.mobile}</span>
                                </div>` : 
                                '<span class="text-gray-400">N/A</span>'}
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button onclick="editStudent('${student.id}')" class="action-btn action-btn-edit">
                                    <i class="fas fa-edit"></i> এডিট
                                </button>
                                <button onclick="showDeleteConfirmation('single', 'আপনি কি নিশ্চিত?', '${student.id}')" 
                                        class="action-btn action-btn-delete">
                                    <i class="fas fa-trash-alt"></i> ডিলিট
                                </button>
                                <button onclick="viewStudentDetails('${student.id}')" class="action-btn action-btn-view">
                                    <i class="fas fa-eye"></i> বিস্তারিত
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            table.innerHTML = html;
        }

        // ছাত্র তালিকা টেবিল রেন্ডার
        function renderStudentsTable() {
            const table = document.getElementById('studentsTable');
            const noStudents = document.getElementById('noStudentsList');
            
            let filteredStudents = students;
            
            if (currentFilterClass) {
                filteredStudents = students.filter(student => student.class === currentFilterClass);
            }
            
            if (filteredStudents.length === 0) {
                table.innerHTML = '';
                noStudents.classList.remove('hidden');
                document.getElementById('totalStudentsCount').textContent = '০';
                document.getElementById('bulkDeleteOptions').classList.add('hidden');
                return;
            }
            
            noStudents.classList.add('hidden');
            document.getElementById('totalStudentsCount').textContent = toBangla(filteredStudents.length);
            
            let html = '';
            
            filteredStudents.forEach((student, index) => {
                const classInfo = getClassLabel(student.class);
                const teacherName = getClassTeacher(student.class);
                const isSelected = selectedStudents.has(student.id);
                
                html += `
                    <tr>
                        <td style="width: 50px;">
                            <input type="checkbox" class="student-checkbox" 
                                   onclick="toggleStudentSelection('${student.id}')" 
                                   ${isSelected ? 'checked' : ''}>
                        </td>
                        <td><span class="font-bold bg-gray-100 px-3 py-1 rounded-lg">${student.id || 'N/A'}</span></td>
                        <td><span class="font-bold text-gray-800">${toBangla(student.roll)}</span></td>
                        <td>
                            <div class="font-bold text-gray-800">${student.name}</div>
                            <div class="text-xs text-gray-500 mt-1">${student.father}</div>
                        </td>
                        <td>
                            <div>
                                <span class="${classInfo.badge} class-badge">${classInfo.label}</span>
                                <div class="text-xs text-purple-600 font-semibold mt-1">${teacherName}</div>
                            </div>
                        </td>
                        <td>${student.father}</td>
                        <td>
                            ${student.mobile ? 
                                `<div class="flex items-center gap-2">
                                    <i class="fas fa-phone text-green-500"></i>
                                    <span>${student.mobile}</span>
                                </div>` : 
                                '<span class="text-gray-400">N/A</span>'}
                        </td>
                        <td>${student.address || 'N/A'}</td>
                        <td>
                            <div class="action-buttons">
                                <button onclick="editStudent('${student.id}')" class="action-btn action-btn-edit">
                                    <i class="fas fa-edit"></i> এডিট
                                </button>
                                <button onclick="showDeleteConfirmation('single', 'আপনি কি নিশ্চিত?', '${student.id}')" 
                                        class="action-btn action-btn-delete">
                                    <i class="fas fa-trash-alt"></i> ডিলিট
                                </button>
                                <button onclick="viewStudentDetails('${student.id}')" class="action-btn action-btn-view">
                                    <i class="fas fa-eye"></i> বিস্তারিত
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            table.innerHTML = html;
            
            // Update bulk delete options visibility
            updateBulkDeleteOptions();
        }

        // ছাত্র নির্বাচন টগল
        function toggleStudentSelection(studentId) {
            if (selectedStudents.has(studentId)) {
                selectedStudents.delete(studentId);
            } else {
                selectedStudents.add(studentId);
            }
            
            updateBulkDeleteOptions();
        }

        // সব ছাত্র নির্বাচন/অনির্বাচন
        function toggleSelectAllStudents() {
            const selectAllCheckbox = document.getElementById('selectAllStudents');
            const studentCheckboxes = document.querySelectorAll('.student-checkbox');
            
            if (selectAllCheckbox.checked) {
                students.forEach(student => {
                    selectedStudents.add(student.id);
                });
                studentCheckboxes.forEach(checkbox => {
                    checkbox.checked = true;
                });
            } else {
                selectedStudents.clear();
                studentCheckboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
            }
            
            updateBulkDeleteOptions();
        }

        // বাল্ক ডিলিট অপশন আপডেট
        function updateBulkDeleteOptions() {
            const bulkDeleteOptions = document.getElementById('bulkDeleteOptions');
            const selectedCount = document.getElementById('selectedCount');
            
            if (selectedStudents.size > 0) {
                bulkDeleteOptions.classList.remove('hidden');
                selectedCount.textContent = selectedStudents.size;
            } else {
                bulkDeleteOptions.classList.add('hidden');
            }
            
            // Update select all checkbox
            const selectAllCheckbox = document.getElementById('selectAllStudents');
            const studentCheckboxes = document.querySelectorAll('.student-checkbox');
            
            if (studentCheckboxes.length > 0) {
                const allSelected = Array.from(studentCheckboxes).every(cb => cb.checked);
                selectAllCheckbox.checked = allSelected;
            }
        }

        // বাল্ক ডিলিট অপশন দেখাও
        function showBulkDeleteOptions() {
            if (students.length === 0) {
                showToast('ডিলিট করার কোন ছাত্র নেই!', 'warning');
                return;
            }
            
            if (selectedStudents.size === 0) {
                // যদি কোন ছাত্র নির্বাচিত না থাকে, সব ছাত্র নির্বাচন করুন
                students.forEach(student => {
                    selectedStudents.add(student.id);
                });
                renderStudentsTable();
            }
            
            showDeleteConfirmation('bulk', 'নির্বাচিত ছাত্রদের ডিলিট করবেন?', 'bulk');
        }

        // বাল্ক ডিলিট বাতিল
        function cancelBulkDelete() {
            selectedStudents.clear();
            renderStudentsTable();
        }

        // নির্বাচিত ছাত্র ডিলিট
        function deleteSelectedStudents() {
            if (selectedStudents.size === 0) {
                showToast('কোন ছাত্র নির্বাচন করা হয়নি!', 'warning');
                return;
            }
            
            showDeleteConfirmation('bulk', 'নির্বাচিত ছাত্রদের ডিলিট করবেন?', 'bulk');
        }

        // উন্নত ডিলিট কনফার্মেশন মডেল দেখাও
        function showDeleteConfirmation(type, message, data) {
            deleteType = type;
            deleteStudentData = data;
            
            const modal = document.getElementById('deleteConfirmationModal');
            const title = document.getElementById('deleteTitle');
            const messageEl = document.getElementById('deleteMessage');
            const studentInfo = document.getElementById('deleteStudentInfo');
            
            // মডেলের টাইটেল ও মেসেজ সেট করুন
            if (type === 'single') {
                const student = students.find(s => s.id === data);
                if (student) {
                    deleteStudentData = student;
                    title.textContent = 'ছাত্র ডিলিট করবেন?';
                    messageEl.textContent = `আপনি কি নিশ্চিত যে "${student.name}" কে ডিলিট করতে চান?`;
                    
                    // ছাত্রের তথ্য দেখান
                    studentInfo.innerHTML = `
                        <div class="delete-student-info-item">
                            <span class="delete-student-info-label">নাম:</span>
                            <span class="delete-student-info-value">${student.name}</span>
                        </div>
                        <div class="delete-student-info-item">
                            <span class="delete-student-info-label">আইডি:</span>
                            <span class="delete-student-info-value">${student.id}</span>
                        </div>
                        <div class="delete-student-info-item">
                            <span class="delete-student-info-label">রোল:</span>
                            <span class="delete-student-info-value">${toBangla(student.roll)}</span>
                        </div>
                        <div class="delete-student-info-item">
                            <span class="delete-student-info-label">শ্রেণি:</span>
                            <span class="delete-student-info-value">${getClassLabel(student.class).label}</span>
                        </div>
                    `;
                    studentInfo.classList.remove('hidden');
                }
            } else if (type === 'bulk') {
                title.textContent = 'নির্বাচিত ছাত্র ডিলিট করবেন?';
                messageEl.textContent = `আপনি কি নিশ্চিত যে ${selectedStudents.size} জন ছাত্রকে ডিলিট করতে চান?`;
                
                // নির্বাচিত ছাত্রদের তালিকা দেখান
                let selectedStudentsList = '';
                let count = 0;
                students.forEach(student => {
                    if (selectedStudents.has(student.id) && count < 3) {
                        selectedStudentsList += `
                            <div class="delete-student-info-item">
                                <span class="delete-student-info-label">${count + 1}. ${student.name}</span>
                                <span class="delete-student-info-value">রোল: ${toBangla(student.roll)}</span>
                            </div>
                        `;
                        count++;
                    }
                });
                
                if (selectedStudents.size > 3) {
                    selectedStudentsList += `
                        <div class="delete-student-info-item">
                            <span class="delete-student-info-label">এবং আরও...</span>
                            <span class="delete-student-info-value">${selectedStudents.size - 3} জন</span>
                        </div>
                    `;
                }
                
                studentInfo.innerHTML = selectedStudentsList;
                studentInfo.classList.remove('hidden');
            } else if (type === 'clearData') {
                title.textContent = 'সমস্ত ডেটা ডিলিট করবেন?';
                messageEl.textContent = 'আপনি কি নিশ্চিত যে সমস্ত ডেটা (ছাত্র, হাজিরা, শিক্ষক) ডিলিট করতে চান?';
                
                // ডেটা পরিসংখ্যান দেখান
                studentInfo.innerHTML = `
                    <div class="delete-student-info-item">
                        <span class="delete-student-info-label">ছাত্র:</span>
                        <span class="delete-student-info-value">${students.length} জন</span>
                    </div>
                    <div class="delete-student-info-item">
                        <span class="delete-student-info-label">হাজিরা রেকর্ড:</span>
                        <span class="delete-student-info-value">${attendance.length} টি</span>
                    </div>
                    <div class="delete-student-info-item">
                        <span class="delete-student-info-label">শ্রেণি শিক্ষক:</span>
                        <span class="delete-student-info-value">${Object.keys(teachers).length} জন</span>
                    </div>
                `;
                studentInfo.classList.remove('hidden');
            }
            
            modal.classList.remove('hidden');
        }

        // ডিলিট কনফার্মেশন বাতিল
        function cancelDelete() {
            document.getElementById('deleteConfirmationModal').classList.add('hidden');
            deleteType = '';
            deleteStudentData = null;
        }

        // ডিলিট নিশ্চিত
        function confirmDelete() {
            document.getElementById('deleteConfirmationModal').classList.add('hidden');
            
            if (deleteType === 'single') {
                // একক ছাত্র ডিলিট
                if (deleteStudentData && deleteStudentData.id) {
                    deleteSingleStudent(deleteStudentData.id);
                }
            } else if (deleteType === 'bulk') {
                // বাল্ক ডিলিট
                deleteBulkStudents();
            } else if (deleteType === 'clearData') {
                // সব ডেটা ডিলিট
                clearAllData();
            }
            
            deleteType = '';
            deleteStudentData = null;
        }

        // একক ছাত্র ডিলিট
        function deleteSingleStudent(studentId) {
            const index = students.findIndex(s => s.id === studentId);
            if (index !== -1) {
                const studentName = students[index].name;
                
                // ছাত্র ডিলিট
                students.splice(index, 1);
                
                // সংশ্লিষ্ট হাজিরা ডেটা ডিলিট
                attendance = attendance.filter(a => a.studentId !== studentId);
                
                // Firebase থেকে ডিলিট
                deleteStudentFromFirebase(studentId);
                
                // লোকাল স্টোরেজে সেভ
                saveToLocal('students', students);
                saveToLocal('attendance', attendance);
                
                // নির্বাচিত ছাত্রদের তালিকা থেকে রিমুভ
                selectedStudents.delete(studentId);
                
                updateUI();
                
                showToast(`${studentName} - ছাত্র সফলভাবে ডিলিট করা হয়েছে!`, 'success');
            }
        }

        // বাল্ক ডিলিট
        function deleteBulkStudents() {
            if (selectedStudents.size === 0) {
                showToast('কোন ছাত্র নির্বাচন করা হয়নি!', 'warning');
                return;
            }
            
            let deletedCount = 0;
            
            // প্রতিটি নির্বাচিত ছাত্র ডিলিট করুন
            selectedStudents.forEach(studentId => {
                const index = students.findIndex(s => s.id === studentId);
                if (index !== -1) {
                    // ছাত্র ডিলিট
                    students.splice(index, 1);
                    
                    // সংশ্লিষ্ট হাজিরা ডেটা ডিলিট
                    attendance = attendance.filter(a => a.studentId !== studentId);
                    
                    // Firebase থেকে ডিলিট
                    deleteStudentFromFirebase(studentId);
                    
                    deletedCount++;
                }
            });
            
            // লোকাল স্টোরেজে সেভ
            saveToLocal('students', students);
            saveToLocal('attendance', attendance);
            
            // নির্বাচিত ছাত্রদের তালিকা ক্লিয়ার
            selectedStudents.clear();
            
            updateUI();
            
            showToast(`${toBangla(deletedCount)} জন ছাত্র সফলভাবে ডিলিট করা হয়েছে!`, 'success');
        }

        // হাজিরা মার্ক করা (বর্তমান তারিখের জন্য)
        function markAttendance(studentId, status) {
            const today = new Date().toDateString();
            markAttendanceForDate(studentId, status, today);
        }

        // নির্দিষ্ট তারিখের জন্য হাজিরা মার্ক করা
        function markAttendanceForDate(studentId, status, dateString) {
            const student = students.find(s => s.id === studentId);
            const statusText = status === 'present' ? 'উপস্থিত' : 'অনুপস্থিত';
            const banglaDate = getBanglaDateFromString(dateString);
            
            const existingIndex = attendance.findIndex(a => 
                a.studentId === studentId && a.date === dateString
            );
            
            const attendanceData = {
                id: `${studentId}_${dateString}`,
                studentId: studentId,
                studentName: student.name,
                studentClass: student.class,
                date: dateString,
                status: status,
                timestamp: new Date().toISOString(),
                teacher: getClassTeacher(student.class),
                corrected: existingIndex !== -1 // সংশোধন করা হয়েছে কিনা
            };
            
            if (existingIndex !== -1) {
                attendance[existingIndex] = attendanceData;
                showToast(`${student.name} - ${banglaDate} তারিখের হাজিরা সংশোধন করা হয়েছে! (${statusText})`, 'success');
            } else {
                attendance.push(attendanceData);
                showToast(`${student.name} - ${banglaDate} তারিখের হাজিরা যোগ করা হয়েছে! (${statusText})`, 'success');
            }
            
            // Save to Firebase
            saveAttendanceToFirebase(attendanceData);
            
            // Update UI
            if (isPastDateMode && selectedPastDate === dateString) {
                renderAttendanceTableForDate(dateString);
            } else if (dateString === new Date().toDateString()) {
                renderAttendanceTable();
            }
            
            updateDashboard();
        }

        // ছাত্র এডিট
        function editStudent(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;
            
            currentStudentId = studentId;
            document.getElementById('modalTitle').textContent = 'ছাত্র তথ্য এডিট করুন';
            document.getElementById('studentId').value = student.id;
            document.getElementById('studentRoll').value = student.roll;
            document.getElementById('studentName').value = student.name;
            document.getElementById('studentClass').value = student.class;
            document.getElementById('studentFather').value = student.father;
            document.getElementById('studentMobile').value = student.mobile || '';
            document.getElementById('studentAddress').value = student.address || '';
            document.getElementById('studentNote').value = student.note || '';
            
            document.getElementById('addStudentModal').classList.remove('hidden');
        }

        // ছাত্র ডিটেইলস দেখাও
        function viewStudentDetails(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;
            
            const classInfo = getClassLabel(student.class);
            const teacherName = getClassTeacher(student.class);
            const studentAttendance = attendance.filter(a => a.studentId === studentId);
            const presentCount = studentAttendance.filter(a => a.status === 'present').length;
            const totalCount = studentAttendance.length;
            const attendanceRate = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
            
            let content = `
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl mb-6">
                    <div class="flex flex-col md:flex-row items-center gap-6">
                        <div class="bg-gradient-to-r from-blue-500 to-purple-500 p-6 rounded-full">
                            <i class="fas fa-user-graduate text-4xl text-white"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">${student.name}</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-id-card text-blue-500"></i>
                                    <span class="text-gray-600">আইডি:</span>
                                    <span class="font-bold">${student.id}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-sort-numeric-up text-blue-500"></i>
                                    <span class="text-gray-600">রোল:</span>
                                    <span class="font-bold">${toBangla(student.roll)}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-graduation-cap text-blue-500"></i>
                                    <span class="text-gray-600">শ্রেণি:</span>
                                    <span class="${classInfo.badge} class-badge">${classInfo.label}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-chalkboard-teacher text-purple-500"></i>
                                    <span class="text-gray-600">শ্রেণি শিক্ষক:</span>
                                    <span class="font-bold text-purple-600">${teacherName}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-xl border border-green-200 text-center">
                        <div class="text-3xl font-bold text-green-600 mb-2">${toBangla(presentCount)}</div>
                        <div class="text-gray-600">উপস্থিত দিন</div>
                    </div>
                    <div class="bg-gradient-to-r from-blue-50 to-cyan-50 p-4 rounded-xl border border-blue-200 text-center">
                        <div class="text-3xl font-bold text-blue-600 mb-2">${toBangla(totalCount)}</div>
                        <div class="text-gray-600">মোট দিন</div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-xl border border-purple-200 text-center">
                        <div class="text-3xl font-bold text-purple-600 mb-2">${toBangla(attendanceRate)}</div>
                        <div class="text-gray-600">উপস্থিতি হার</div>
                    </div>
                </div>
                
                <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-info-circle text-blue-500"></i>
                    অতিরিক্ত তথ্য
                </h4>
                <div class="bg-gray-50 p-4 rounded-xl mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <div class="text-sm text-gray-500 mb-1">পিতার নাম</div>
                            <div class="font-semibold">${student.father}</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500 mb-1">মোবাইল নম্বর</div>
                            <div class="font-semibold">${student.mobile || 'নাই'}</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500 mb-1">ঠিকানা</div>
                            <div class="font-semibold">${student.address || 'নাই'}</div>
                        </div>
                        <div class="md:col-span-2">
                            <div class="text-sm text-gray-500 mb-1">বিশেষ মন্তব্য</div>
                            <div class="font-semibold">${student.note || 'নাই'}</div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-4 rounded-xl border border-yellow-200 mb-6">
                    <h4 class="font-bold text-yellow-700 mb-2 flex items-center gap-2">
                        <i class="fas fa-phone-alt"></i>
                        প্রয়োজনে যোগাযোগ
                    </h4>
                    <div class="text-xl font-bold text-yellow-800">০১৮১১২৩৬৫৪৮</div>
                    <div class="text-sm text-yellow-600 mt-1">যেকোনো সমস্যা বা জিজ্ঞাসার জন্য এই নম্বরে কল করুন</div>
                </div>
                
                <div class="flex gap-4 pt-6 border-t">
                    <button onclick="editStudent('${student.id}')" class="btn btn-primary flex-1">
                        <i class="fas fa-edit"></i> তথ্য এডিট
                    </button>
                    <button onclick="showDeleteConfirmation('single', 'আপনি কি নিশ্চিত?', '${student.id}')" 
                            class="btn btn-danger flex-1">
                        <i class="fas fa-trash-alt"></i> ডিলিট করুন
                    </button>
                    <button onclick="closeReportModal()" class="btn bg-gradient-to-r from-gray-500 to-gray-600 flex-1">
                        <i class="fas fa-times"></i> বন্ধ করুন
                    </button>
                </div>
            `;
            
            document.getElementById('reportTitle').textContent = 'ছাত্রের বিস্তারিত তথ্য';
            document.getElementById('reportContent').innerHTML = content;
            document.getElementById('reportModal').classList.remove('hidden');
        }

        // সবাইকে উপস্থিত মার্ক
        function markAllPresent() {
            const dateString = isPastDateMode && selectedPastDate ? selectedPastDate : new Date().toDateString();
            const banglaDate = getBanglaDateFromString(dateString);
            
            students.forEach(student => {
                const attendanceData = {
                    id: `${student.id}_${dateString}`,
                    studentId: student.id,
                    studentName: student.name,
                    studentClass: student.class,
                    date: dateString,
                    status: 'present',
                    timestamp: new Date().toISOString(),
                    teacher: getClassTeacher(student.class),
                    corrected: true
                };
                
                const existingIndex = attendance.findIndex(a => 
                    a.studentId === student.id && a.date === dateString
                );
                
                if (existingIndex !== -1) {
                    attendance[existingIndex] = attendanceData;
                } else {
                    attendance.push(attendanceData);
                }
                
                // Save to Firebase
                saveAttendanceToFirebase(attendanceData);
            });
            
            // Update UI
            if (isPastDateMode && selectedPastDate) {
                renderAttendanceTableForDate(selectedPastDate);
            } else {
                renderAttendanceTable();
            }
            
            updateDashboard();
            
            showToast(`সবাইকে ${banglaDate} তারিখের জন্য উপস্থিত মার্ক করা হয়েছে!`, 'success');
        }

        // ছাত্র সংরক্ষণ
        function saveStudent() {
            const id = document.getElementById('studentId').value.trim();
            const roll = document.getElementById('studentRoll').value.trim();
            const name = document.getElementById('studentName').value.trim();
            const studentClass = document.getElementById('studentClass').value;
            const father = document.getElementById('studentFather').value.trim();
            const mobile = document.getElementById('studentMobile').value.trim();
            const address = document.getElementById('studentAddress').value.trim();
            const note = document.getElementById('studentNote').value.trim();
            
            if (!id || !roll || !name || !studentClass || !father) {
                showToast('দয়া করে সব প্রয়োজনীয় তথ্য দিন!', 'error');
                return;
            }
            
            const studentData = {
                id: id,
                roll: parseInt(roll),
                name: name,
                class: studentClass,
                father: father,
                mobile: mobile,
                address: address,
                note: note,
                createdAt: new Date().toISOString()
            };
            
            if (currentStudentId === null) {
                // Add new student
                students.push(studentData);
                saveStudentToFirebase(studentData);
                showToast('নতুন ছাত্র যোগ করা হয়েছে!', 'success');
            } else {
                // Update existing student
                const index = students.findIndex(s => s.id === currentStudentId);
                if (index !== -1) {
                    students[index] = studentData;
                    saveStudentToFirebase(studentData);
                    showToast('ছাত্র তথ্য আপডেট করা হয়েছে!', 'success');
                }
                currentStudentId = null;
            }
            
            // Save locally
            saveToLocal('students', students);
            
            closeModal();
            updateUI();
        }

        // ছাত্র খুঁজা
        function searchStudents(page = 'attendance') {
            const searchInputId = page === 'attendance' ? 'searchInputAttendance' : 'searchInputStudents';
            const searchText = document.getElementById(searchInputId).value.toLowerCase();
            
            if (!searchText) {
                if (page === 'attendance') {
                    if (isPastDateMode && selectedPastDate) {
                        renderAttendanceTableForDate(selectedPastDate);
                    } else {
                        renderAttendanceTable();
                    }
                } else {
                    renderStudentsTable();
                }
                return;
            }
            
            const filteredStudents = students.filter(student => 
                student.name.toLowerCase().includes(searchText) ||
                student.id.toLowerCase().includes(searchText) ||
                student.roll.toString().includes(searchText) ||
                student.class.toString().includes(searchText) ||
                student.father.toLowerCase().includes(searchText) ||
                (student.mobile && student.mobile.includes(searchText))
            );
            
            if (page === 'attendance') {
                renderFilteredAttendanceTable(filteredStudents);
            } else {
                renderFilteredStudentsTable(filteredStudents);
            }
        }

        function renderFilteredAttendanceTable(filteredStudents) {
            const table = document.getElementById('attendanceTable');
            const noStudents = document.getElementById('noStudents');
            const dateString = isPastDateMode && selectedPastDate ? selectedPastDate : new Date().toDateString();
            
            if (filteredStudents.length === 0) {
                table.innerHTML = '';
                noStudents.classList.remove('hidden');
                return;
            }
            
            noStudents.classList.add('hidden');
            
            let html = '';
            
            filteredStudents.forEach((student, index) => {
                const studentAttendance = attendance.find(a => 
                    a.studentId === student.id && a.date === dateString
                );
                
                const status = studentAttendance ? studentAttendance.status : 'absent';
                const classInfo = getClassLabel(student.class);
                const teacherName = getClassTeacher(student.class);
                
                html += `
                    <tr class="${status === 'present' ? 'status-present' : 'status-absent'}">
                        <td><span class="font-bold bg-gray-100 px-3 py-1 rounded-lg">${student.id || 'N/A'}</span></td>
                        <td><span class="font-bold text-gray-800">${toBangla(student.roll)}</span></td>
                        <td>
                            <div class="font-bold text-gray-800">${student.name}</div>
                            <div class="text-xs text-gray-500 mt-1">${student.father}</div>
                        </td>
                        <td class="attendance-column">
                            <div class="flex flex-col md:flex-row gap-2">
                                <button onclick="markAttendanceForDate('${student.id}', 'present', '${dateString}')" 
                                        class="attendance-btn ${status === 'present' ? 'bg-green-500 text-white border-green-500' : 'bg-white text-green-500 border-green-500'}">
                                    <i class="fas fa-check"></i> উপস্থিত
                                </button>
                                <button onclick="markAttendanceForDate('${student.id}', 'absent', '${dateString}')" 
                                        class="attendance-btn ${status === 'absent' ? 'bg-red-500 text-white border-red-500' : 'bg-white text-red-500 border-red-500'}">
                                    <i class="fas fa-times"></i> অনুপস্থিত
                                </button>
                            </div>
                            <div class="text-xs mt-2 text-center ${status === 'present' ? 'text-green-600 font-bold' : 'text-red-600 font-bold'}">
                                ${status === 'present' ? '✓ উপস্থিত' : '✗ অনুপস্থিত'}
                            </div>
                        </td>
                        <td>
                            <div>
                                <span class="${classInfo.badge} class-badge">${classInfo.label}</span>
                                <div class="text-xs text-purple-600 font-semibold mt-1">${teacherName}</div>
                            </div>
                        </td>
                        <td>${student.father}</td>
                        <td>
                            ${student.mobile ? 
                                `<div class="flex items-center gap-2">
                                    <i class="fas fa-phone text-green-500"></i>
                                    <span>${student.mobile}</span>
                                </div>` : 
                                '<span class="text-gray-400">N/A</span>'}
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button onclick="editStudent('${student.id}')" class="action-btn action-btn-edit">
                                    <i class="fas fa-edit"></i> এডিট
                                </button>
                                <button onclick="showDeleteConfirmation('single', 'আপনি কি নিশ্চিত?', '${student.id}')" 
                                        class="action-btn action-btn-delete">
                                    <i class="fas fa-trash-alt"></i> ডিলিট
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            table.innerHTML = html;
        }

        function renderFilteredStudentsTable(filteredStudents) {
            const table = document.getElementById('studentsTable');
            const noStudents = document.getElementById('noStudentsList');
            
            if (filteredStudents.length === 0) {
                table.innerHTML = '';
                noStudents.classList.remove('hidden');
                document.getElementById('totalStudentsCount').textContent = '০';
                document.getElementById('bulkDeleteOptions').classList.add('hidden');
                return;
            }
            
            noStudents.classList.add('hidden');
            document.getElementById('totalStudentsCount').textContent = toBangla(filteredStudents.length);
            
            let html = '';
            
            filteredStudents.forEach((student, index) => {
                const classInfo = getClassLabel(student.class);
                const teacherName = getClassTeacher(student.class);
                const isSelected = selectedStudents.has(student.id);
                
                html += `
                    <tr>
                        <td style="width: 50px;">
                            <input type="checkbox" class="student-checkbox" 
                                   onclick="toggleStudentSelection('${student.id}')" 
                                   ${isSelected ? 'checked' : ''}>
                        </td>
                        <td><span class="font-bold bg-gray-100 px-3 py-1 rounded-lg">${student.id || 'N/A'}</span></td>
                        <td><span class="font-bold text-gray-800">${toBangla(student.roll)}</span></td>
                        <td>
                            <div class="font-bold text-gray-800">${student.name}</div>
                            <div class="text-xs text-gray-500 mt-1">${student.father}</div>
                        </td>
                        <td>
                            <div>
                                <span class="${classInfo.badge} class-badge">${classInfo.label}</span>
                                <div class="text-xs text-purple-600 font-semibold mt-1">${teacherName}</div>
                            </div>
                        </td>
                        <td>${student.father}</td>
                        <td>
                            ${student.mobile ? 
                                `<div class="flex items-center gap-2">
                                    <i class="fas fa-phone text-green-500"></i>
                                    <span>${student.mobile}</span>
                                </div>` : 
                                '<span class="text-gray-400">N/A</span>'}
                        </td>
                        <td>${student.address || 'N/A'}</td>
                        <td>
                            <div class="action-buttons">
                                <button onclick="editStudent('${student.id}')" class="action-btn action-btn-edit">
                                    <i class="fas fa-edit"></i> এডিট
                                </button>
                                <button onclick="showDeleteConfirmation('single', 'আপনি কি নিশ্চিত?', '${student.id}')" 
                                        class="action-btn action-btn-delete">
                                    <i class="fas fa-trash-alt"></i> ডিলিট
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            table.innerHTML = html;
            updateBulkDeleteOptions();
        }

        // শিক্ষক ব্যবস্থাপনা দেখাও
        function showTeacherManagement() {
            renderTeacherInputs();
            document.getElementById('teacherManagementModal').classList.remove('hidden');
        }

        // শিক্ষক ইনপুট রেন্ডার
        function renderTeacherInputs() {
            const ibtidayeeContainer = document.getElementById('ibtidayeeTeachers');
            const dakhilContainer = document.getElementById('dakhilTeachers');
            const alimContainer = document.getElementById('alimTeachers');
            
            let ibtidayeeHtml = '';
            let dakhilHtml = '';
            let alimHtml = '';
            
            // ইবতেদায়ী শ্রেণিসমূহ
            for (let i = 1; i <= 5; i++) {
                const classValue = `ibtidayee-${i}`;
                const classInfo = getClassLabel(classValue);
                const currentTeacher = teachers[classValue] || '';
                
                ibtidayeeHtml += `
                    <div class="bg-gradient-to-r from-amber-50 to-orange-50 p-4 rounded-xl border border-amber-200">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ${classInfo.label}
                        </label>
                        <input type="text" 
                               id="teacher-${classValue}" 
                               class="w-full p-3 border-2 border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition"
                               value="${currentTeacher}"
                               placeholder="শ্রেণি শিক্ষকের নাম লিখুন">
                        <div class="text-xs text-gray-500 mt-1"></div>
                    </div>
                `;
            }
            
            // দাখিল শ্রেণিসমূহ
            for (let i = 6; i <= 10; i++) {
                const classValue = `dakhil-${i}`;
                const classInfo = getClassLabel(classValue);
                const currentTeacher = teachers[classValue] || '';
                
                dakhilHtml += `
                    <div class="bg-gradient-to-r from-blue-50 to-cyan-50 p-4 rounded-xl border border-blue-200">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ${classInfo.label}
                        </label>
                        <input type="text" 
                               id="teacher-${classValue}" 
                               class="w-full p-3 border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                               value="${currentTeacher}"
                               placeholder="শ্রেণি শিক্ষকের নাম লিখুন">
                        <div class="text-xs text-gray-500 mt-1"></div>
                    </div>
                `;
            }
            
            // আলিম শ্রেণিসমূহ
            for (let i = 11; i <= 12; i++) {
                const classValue = `alim-${i}`;
                const classInfo = getClassLabel(classValue);
                const currentTeacher = teachers[classValue] || '';
                
                alimHtml += `
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-xl border border-purple-200">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ${classInfo.label}
                        </label>
                        <input type="text" 
                               id="teacher-${classValue}" 
                               class="w-full p-3 border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition"
                               value="${currentTeacher}"
                               placeholder="শ্রেণি শিক্ষকের নাম লিখুন">
                        <div class="text-xs text-gray-500 mt-1"></div>
                    </div>
                `;
            }
            
            ibtidayeeContainer.innerHTML = ibtidayeeHtml;
            dakhilContainer.innerHTML = dakhilHtml;
            alimContainer.innerHTML = alimHtml;
        }

        // শিক্ষক সংরক্ষণ
        function saveTeachers() {
            // ইবতেদায়ী শ্রেণিসমূহ
            for (let i = 1; i <= 5; i++) {
                const classValue = `ibtidayee-${i}`;
                const input = document.getElementById(`teacher-${classValue}`);
                if (input && input.value.trim()) {
                    teachers[classValue] = input.value.trim();
                }
            }
            
            // দাখিল শ্রেণিসমূহ
            for (let i = 6; i <= 10; i++) {
                const classValue = `dakhil-${i}`;
                const input = document.getElementById(`teacher-${classValue}`);
                if (input && input.value.trim()) {
                    teachers[classValue] = input.value.trim();
                }
            }
            
            // আলিম শ্রেণিসমূহ
            for (let i = 11; i <= 12; i++) {
                const classValue = `alim-${i}`;
                const input = document.getElementById(`teacher-${classValue}`);
                if (input && input.value.trim()) {
                    teachers[classValue] = input.value.trim();
                }
            }
            
            // Save to Firebase
            saveTeachersToFirebase();
            
            // Save locally
            saveToLocal('teachers', teachers);
            
            closeTeacherModal();
            updateUI();
            
            showToast('শ্রেণি শিক্ষকদের তথ্য সংরক্ষণ করা হয়েছে!', 'success');
        }

        // শ্রেণি হাজিরা সীট দেখাও
        function showClassSheets() {
            document.getElementById('classSheetsModal').classList.remove('hidden');
            loadClassSheet();
        }

        // শ্রেণি সীট লোড
        function loadClassSheet() {
            const selectedClass = document.getElementById('sheetClassSelect').value;
            let filteredStudents = students;
            
            if (selectedClass) {
                filteredStudents = students.filter(student => student.class === selectedClass);
            }
            
            const dateString = selectedPastDate || new Date().toDateString();
            const classInfo = selectedClass ? getClassLabel(selectedClass) : {label: 'সকল শ্রেণি', badge: ''};
            const teacherName = selectedClass ? getClassTeacher(selectedClass) : 'প্রতিষ্ঠান প্রধান';
            const banglaDate = toBanglaDate(dateString);
            
            let content = `
                <h3 class="text-lg font-bold text-gray-800 mb-2">
                    ${classInfo.label} - হাজিরা সীট
                </h3>
                <div class="text-sm ${selectedPastDate ? 'text-orange-600' : 'text-purple-600'} font-semibold mb-4">
                    তারিখ: ${banglaDate} ${selectedPastDate ? '(অতীত তারিখ)' : ''}
                </div>
                <div class="text-sm text-purple-600 font-semibold mb-4">
                    শ্রেণি শিক্ষক: ${teacherName}
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr>
                                <th>রোল</th>
                                <th>নাম</th>
                                <th>পিতা</th>
                                <th>শ্রেণি</th>
                                <th>হাজিরা</th>
                                <th>স্বাক্ষর</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            filteredStudents.sort((a, b) => a.roll - b.roll).forEach((student, index) => {
                const studentAttendance = attendance.find(a => 
                    a.studentId === student.id && a.date === dateString
                );
                const status = studentAttendance ? studentAttendance.status : 'absent';
                const studentClassInfo = getClassLabel(student.class);
                
                content += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="py-3 px-4 text-center font-bold">${toBangla(student.roll)}</td>
                        <td class="py-3 px-4">${student.name}</td>
                        <td class="py-3 px-4">${student.father}</td>
                        <td class="py-3 px-4">
                            <span class="${studentClassInfo.badge} class-badge text-xs">${studentClassInfo.label}</span>
                        </td>
                        <td class="py-3 px-4 text-center">
                            <div class="flex justify-center">
                                <span class="${status === 'present' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} px-3 py-1 rounded-full text-sm font-bold">
                                    ${status === 'present' ? 'উপস্থিত' : 'অনুপস্থিত'}
                                </span>
                            </div>
                        </td>
                        <td class="py-3 px-4 border-l border-gray-300 h-16"></td>
                    </tr>
                `;
            });
            
            content += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-6 pt-6 border-t">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="text-center">
                            <div class="font-bold text-gray-800 mb-2">শিক্ষক</div>
                            <div class="text-sm text-purple-600 mb-2">${teacherName}</div>
                            <div class="border-b border-gray-400 pt-8"></div>
                            <div class="text-sm text-gray-600 mt-1">নাম ও স্বাক্ষর</div>
                        </div>
                        <div class="text-center">
                            <div class="font-bold text-gray-800 mb-2">অধ্যক্ষ</div>
                            <div class="border-b border-gray-400 pt-8"></div>
                            <div class="text-sm text-gray-600 mt-1">নাম ও স্বাক্ষর</div>
                        </div>
                        <div class="text-center">
                            <div class="font-bold text-gray-800 mb-2">তারিখ</div>
                            <div class="text-xl font-bold ${selectedPastDate ? 'text-orange-600' : 'text-blue-600'} pt-4">${banglaDate}</div>
                            <div class="text-sm text-gray-600 mt-1">হাজিরা তারিখ</div>
                        </div>
                    </div>
                </div>
                <div class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-phone-alt text-blue-500"></i>
                        <div>
                            <div class="text-sm text-blue-600">প্রয়োজনে যোগাযোগ:</div>
                            <div class="font-bold text-blue-800">০১৮১১২৩৬৫৪৮</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('classSheetContent').innerHTML = content;
        }

        // শ্রেণি সীট প্রিন্ট
        function printClassSheet() {
            const printContent = document.getElementById('classSheetContent').innerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = `
                <!DOCTYPE html>
                <html lang="bn">
                <head>
                    <meta charset="UTF-8">
                    <title>শ্রেণি হাজিরা সীট</title>
                    <style>
                        body {
                            font-family: 'Hind Siliguri', sans-serif;
                            padding: 20px;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 20px;
                        }
                        th, td {
                            border: 1px solid #ddd;
                            padding: 8px;
                            text-align: left;
                        }
                        th {
                            background-color: #f2f2f2;
                            font-weight: bold;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                            border-bottom: 2px solid #333;
                            padding-bottom: 20px;
                        }
                        .footer {
                            margin-top: 30px;
                            text-align: center;
                        }
                        .contact-info {
                            background: #f0f9ff;
                            padding: 10px;
                            border-radius: 5px;
                            margin: 20px 0;
                            text-align: center;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>মেহেরপুর আনছারুল উলূম আলিম মাদ্রাসা</h1>
                        <h2>শ্রেণি হাজিরা সীট</h2>
                        <p>EIIN: ১৩০২৯০ | কোড: ১৮৭৫২</p>
                        <p>তারিখ: ${document.getElementById('todayDate2').textContent}</p>
                    </div>
                    ${printContent}
                    <div class="contact-info">
                        <p>প্রয়োজনে যোগাযোগ: ০১৮১১২৩৬৫৪৮</p>
                    </div>
                    <div class="footer">
                        <p>© ${new Date().getFullYear()} মেহেরপুর আনছারুল উলূম আলিম মাদ্রাসা</p>
                    </div>
                </body>
                </html>
            `;
            
            window.print();
            document.body.innerHTML = originalContent;
            loadClassSheet();
        }

        // শ্রেণি সীট ডাউনলোড
        function exportClassSheet() {
            const dateString = selectedPastDate || new Date().toDateString();
            const date = new Date(dateString);
            const dateStr = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
            const selectedClass = document.getElementById('sheetClassSelect').value;
            const className = selectedClass ? getClassLabel(selectedClass).label : 'সকল-শ্রেণি';
            const teacherName = selectedClass ? getClassTeacher(selectedClass) : 'প্রতিষ্ঠান প্রধান';
            
            let csv = 'রোল,নাম,পিতা,শ্রেণি,হাজিরা,শ্রেণি শিক্ষক,তারিখ\n';
            
            let filteredStudents = students;
            if (selectedClass) {
                filteredStudents = students.filter(student => student.class === selectedClass);
            }
            
            filteredStudents.sort((a, b) => a.roll - b.roll).forEach((student, index) => {
                const studentAttendance = attendance.find(a => 
                    a.studentId === student.id && a.date === dateString
                );
                const status = studentAttendance ? studentAttendance.status : 'absent';
                const statusText = status === 'present' ? 'উপস্থিত' : 'অনুপস্থিত';
                
                csv += `${student.roll},${student.name},${student.father},${getClassLabel(student.class).label},${statusText},${teacherName},${toBanglaDate(dateString)}\n`;
            });
            
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `হাজিরা-সীট-${className}-${dateStr}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('হাজিরা সীট ডাউনলোড করা হয়েছে!', 'success');
        }

        // সাপ্তাহিক রিপোর্ট
        function renderWeeklyReport() {
            const container = document.getElementById('weeklyReport');
            const days = ['রবি', 'সোম', 'মঙ্গল', 'বুধ', 'বৃহ', 'শুক্র', 'শনি'];
            
            let html = '';
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                
                const dayAttendance = attendance.filter(a => a.date === dateStr);
                const presentCount = dayAttendance.filter(a => a.status === 'present').length;
                const absentCount = dayAttendance.filter(a => a.status === 'absent').length;
                const totalCount = students.length;
                
                const rate = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
                
                let colorClass = 'from-gray-50 to-gray-100';
                if (rate >= 90) colorClass = 'from-green-50 to-emerald-100';
                else if (rate >= 70) colorClass = 'from-blue-50 to-cyan-100';
                else if (rate >= 50) colorClass = 'from-yellow-50 to-amber-100';
                else colorClass = 'from-red-50 to-pink-100';
                
                html += `
                    <div class="text-center p-4 bg-gradient-to-br ${colorClass} rounded-xl cursor-pointer hover:shadow-lg transition" 
                         onclick="showDayReport('${dateStr}')">
                        <div class="font-bold text-gray-800 text-lg mb-1">${days[date.getDay()]}</div>
                        <div class="text-sm text-gray-600 mb-3">${toBangla(date.getDate())}/${toBangla(date.getMonth() + 1)}</div>
                        <div class="flex justify-center items-center gap-4 mb-3">
                            <div class="text-center">
                                <div class="text-green-600 font-bold text-xl">${toBangla(presentCount)}</div>
                                <div class="text-xs text-green-500">উপস্থিত</div>
                            </div>
                            <div class="text-center">
                                <div class="text-red-600 font-bold text-xl">${toBangla(absentCount)}</div>
                                <div class="text-xs text-red-500">অনুপস্থিত</div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r ${rate >= 90 ? 'from-green-500 to-emerald-500' : rate >= 70 ? 'from-blue-500 to-cyan-500' : rate >= 50 ? 'from-yellow-500 to-amber-500' : 'from-red-500 to-pink-500'} h-2 rounded-full" 
                                     style="width: ${rate}%"></div>
                            </div>
                            <div class="text-xs font-bold mt-2 ${rate >= 90 ? 'text-green-600' : rate >= 70 ? 'text-blue-600' : rate >= 50 ? 'text-yellow-600' : 'text-red-600'}">
                                ${toBangla(rate)}%
                            </div>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        // সাপ্তাহিক রিপোর্ট দেখাও
        function showWeeklyReport() {
            let content = `
                <h3 class="text-lg font-bold mb-6">এই সপ্তাহের হাজিরা রিপোর্ট</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr>
                                <th>তারিখ</th>
                                <th>উপস্থিত</th>
                                <th>অনুপস্থিত</th>
                                <th>মোট</th>
                                <th>হার</th>
                                <th>বিস্তারিত</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                
                const dayAttendance = attendance.filter(a => a.date === dateStr);
                const presentCount = dayAttendance.filter(a => a.status === 'present').length;
                const absentCount = dayAttendance.filter(a => a.status === 'absent').length;
                const totalCount = students.length;
                const rate = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
                
                content += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="py-3 px-4">
                            <div class="font-semibold">${banglaDays[date.getDay()]}</div>
                            <div class="text-sm text-gray-600">${toBangla(date.getDate())} ${banglaMonths[date.getMonth()]}</div>
                        </td>
                        <td class="py-3 px-4">
                            <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-bold">
                                ${toBangla(presentCount)}
                            </span>
                        </td>
                        <td class="py-3 px-4">
                            <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-bold">
                                ${toBangla(absentCount)}
                            </span>
                        </td>
                        <td class="py-3 px-4 font-bold">${toBangla(totalCount)}</td>
                        <td class="py-3 px-4">
                            <span class="${rate >= 90 ? 'text-green-600' : rate >= 70 ? 'text-blue-600' : rate >= 50 ? 'text-yellow-600' : 'text-red-600'} font-bold">
                                ${toBangla(rate)}%
                            </span>
                        </td>
                        <td class="py-3 px-4">
                            <button onclick="showDayReport('${dateStr}')" class="btn btn-info text-sm py-1">
                                <i class="fas fa-eye"></i> দেখুন
                            </button>
                        </td>
                    </tr>
                `;
            }
            
            content += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-phone-alt text-blue-500"></i>
                        <div>
                            <div class="text-sm text-blue-600">প্রয়োজনে যোগাযোগ:</div>
                            <div class="font-bold text-blue-800">০১৮১১২৩৬৫৪৮</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('reportTitle').textContent = 'সাপ্তাহিক হাজিরা রিপোর্ট';
            document.getElementById('reportContent').innerHTML = content;
            document.getElementById('reportModal').classList.remove('hidden');
        }

        // নির্দিষ্ট দিনের রিপোর্ট
        function showDayReport(dateStr) {
            const date = new Date(dateStr);
            const dayAttendance = attendance.filter(a => a.date === dateStr);
            
            let presentStudents = [];
            let absentStudents = [];
            
            students.forEach(student => {
                const studentAttendance = dayAttendance.find(a => a.studentId === student.id);
                if (studentAttendance && studentAttendance.status === 'present') {
                    presentStudents.push(student);
                } else {
                    absentStudents.push(student);
                }
            });
            
            const banglaDate = `${banglaDays[date.getDay()]}, ${toBangla(date.getDate())} ${banglaMonths[date.getMonth()]} ${toBangla(date.getFullYear())}`;
            
            let content = `
                <h3 class="text-lg font-bold mb-4">${banglaDate} - হাজিরা রিপোর্ট</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200">
                        <h4 class="font-bold text-green-700 mb-4 flex items-center gap-2">
                            <i class="fas fa-user-check"></i>
                            উপস্থিত (${presentStudents.length})
                        </h4>
                        <div class="max-h-60 overflow-y-auto">
            `;
            
            if (presentStudents.length === 0) {
                content += `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-user-times text-3xl mb-3"></i>
                        <div>কোন ছাত্র উপস্থিত নেই</div>
                    </div>
                `;
            } else {
                presentStudents.forEach(student => {
                    const classInfo = getClassLabel(student.class);
                    const teacherName = getClassTeacher(student.class);
                    
                    content += `
                        <div class="flex items-center justify-between p-3 bg-white rounded-lg mb-2 shadow-sm">
                            <div>
                                <div class="font-semibold">${student.name}</div>
                                <div class="text-sm text-gray-600">রোল: ${toBangla(student.roll)} | ${classInfo.label}</div>
                                <div class="text-xs text-purple-600">${teacherName}</div>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="badge badge-success text-xs">উপস্থিত</span>
                            </div>
                        </div>
                    `;
                });
            }
            
            content += `
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-red-50 to-pink-50 p-6 rounded-xl border border-red-200">
                        <h4 class="font-bold text-red-700 mb-4 flex items-center gap-2">
                            <i class="fas fa-user-times"></i>
                            অনুপস্থিত (${absentStudents.length})
                        </h4>
                        <div class="max-h-60 overflow-y-auto">
            `;
            
            if (absentStudents.length === 0) {
                content += `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-user-check text-3xl mb-3"></i>
                        <div>সবাই উপস্থিত</div>
                    </div>
                `;
            } else {
                absentStudents.forEach(student => {
                    const classInfo = getClassLabel(student.class);
                    const teacherName = getClassTeacher(student.class);
                    
                    content += `
                        <div class="flex items-center justify-between p-3 bg-white rounded-lg mb-2 shadow-sm">
                            <div>
                                <div class="font-semibold">${student.name}</div>
                                <div class="text-sm text-gray-600">রোল: ${toBangla(student.roll)} | ${classInfo.label}</div>
                                <div class="text-xs text-purple-600">${teacherName}</div>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="badge badge-danger text-xs">অনুপস্থিত</span>
                            </div>
                        </div>
                    `;
                });
            }
            
            content += `
                        </div>
                    </div>
                </div>
                
                <div class="text-center">
                    <div class="inline-block bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200">
                        <div class="text-3xl font-bold text-blue-600 mb-2">
                            ${students.length > 0 ? Math.round((presentStudents.length / students.length) * 100) : 0}%
                        </div>
                        <div class="text-gray-600">উপস্থিতি হার</div>
                        <div class="text-sm text-gray-500 mt-2">
                            ${presentStudents.length} / ${students.length} ছাত্র
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl border border-yellow-200">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-phone-alt text-yellow-600"></i>
                        <div>
                            <div class="text-sm text-yellow-700">প্রয়োজনে যোগাযোগ:</div>
                            <div class="font-bold text-yellow-800">০১৮১১২৩৬৫৪৮</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('reportTitle').textContent = `${banglaDate} - হাজিরা রিপোর্ট`;
            document.getElementById('reportContent').innerHTML = content;
            document.getElementById('reportModal').classList.remove('hidden');
        }

        // উপস্থিত ছাত্র দেখাও
        function showStudents(status) {
            const today = new Date().toDateString();
            const dayAttendance = attendance.filter(a => a.date === today);
            
            let filteredStudents = [];
            
            if (status === 'present') {
                filteredStudents = students.filter(student => {
                    const studentAttendance = dayAttendance.find(a => a.studentId === student.id);
                    return studentAttendance && studentAttendance.status === 'present';
                });
            } else if (status === 'absent') {
                filteredStudents = students.filter(student => {
                    const studentAttendance = dayAttendance.find(a => a.studentId === student.id);
                    return !studentAttendance || studentAttendance.status === 'absent';
                });
            } else {
                filteredStudents = students;
            }
            
            const statusText = status === 'present' ? 'উপস্থিত' : status === 'absent' ? 'অনুপস্থিত' : 'সকল';
            
            let content = `
                <h3 class="text-lg font-bold mb-4">${statusText} ছাত্র-ছাত্রী (${filteredStudents.length})</h3>
                <div class="max-h-96 overflow-y-auto">
            `;
            
            filteredStudents.forEach((student, index) => {
                const classInfo = getClassLabel(student.class);
                const teacherName = getClassTeacher(student.class);
                const studentAttendance = dayAttendance.find(a => a.studentId === student.id);
                
                content += `
                    <div class="flex items-center justify-between p-4 ${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'} rounded-xl mb-3 shadow-sm">
                        <div class="flex-1">
                            <div class="flex items-center gap-4">
                                <div>
                                    <div class="font-semibold text-gray-800">${student.name}</div>
                                    <div class="text-sm text-gray-600 mt-1">
                                        আইডি: ${student.id} | রোল: ${toBangla(student.roll)} | 
                                        <span class="${classInfo.badge} class-badge">${classInfo.label}</span>
                                    </div>
                                    <div class="text-sm text-gray-600">
                                        পিতা: ${student.father} | শিক্ষক: <span class="text-purple-600">${teacherName}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <button onclick="markAttendance('${student.id}', '${status === 'present' ? 'absent' : 'present'}')" 
                                    class="btn ${status === 'present' ? 'btn-danger' : 'btn-success'}">
                                ${status === 'present' ? 'অনুপস্থিত' : 'উপস্থিত'}
                            </button>
                        </div>
                    </div>
                `;
            });
            
            content += `
                </div>
                <div class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-phone-alt text-blue-500"></i>
                        <div>
                            <div class="text-sm text-blue-600">প্রয়োজনে যোগাযোগ:</div>
                            <div class="font-bold text-blue-800">০১৮১১২৩৬৫৪৮</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('reportTitle').textContent = `${statusText} ছাত্র-ছাত্রীর তালিকা`;
            document.getElementById('reportContent').innerHTML = content;
            document.getElementById('reportModal').classList.remove('hidden');
        }

        // সব ছাত্র দেখাও
        function showAllStudents() {
            showStudents('all');
        }

        // আজকের রিপোর্ট দেখাও
        function showTodayReport() {
            const today = new Date().toDateString();
            showDayReport(today);
        }

        // কল সাপোর্ট ফাংশন
        function callSupport() {
            showToast('কল করা হচ্ছে: ০১৮১১২৩৬৫৪৮', 'info');
            // মোবাইল ডিভাইসে কল করার জন্য
            if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                window.open('tel:01811236548');
            } else {
                // কম্পিউটারে কল করার অপশন
                document.getElementById('reportTitle').textContent = 'প্রয়োজনে যোগাযোগ';
                document.getElementById('reportContent').innerHTML = `
                    <div class="text-center p-8">
                        <div class="bg-gradient-to-r from-green-500 to-emerald-500 p-6 rounded-full inline-block mb-6">
                            <i class="fas fa-phone-alt text-white text-4xl"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">প্রয়োজনে কল করুন</h3>
                        <div class="text-4xl font-bold text-blue-600 mb-6">০১৮১১২৩৬৫৪৮</div>
                        <div class="text-gray-600 mb-8">
                            যেকোনো সমস্যা বা জিজ্ঞাসার জন্য উপরের নম্বরে কল করুন।
                            আমাদের সাপোর্ট টিম আপনাকে সাহায্য করতে প্রস্তুত।
                        </div>
                        <button onclick="closeReportModal()" class="btn btn-primary">
                            <i class="fas fa-check"></i> ঠিক আছে
                        </button>
                    </div>
                `;
                document.getElementById('reportModal').classList.remove('hidden');
            }
        }

        // কনফার্মেশন মডেল
        function confirmAction(action, title, message, data = null) {
            pendingAction = action;
            confirmationData = data;
            document.getElementById('confirmationTitle').textContent = title;
            document.getElementById('confirmationMessage').textContent = message;
            document.getElementById('confirmationModal').classList.remove('hidden');
        }

        function cancelAction() {
            pendingAction = null;
            confirmationData = null;
            document.getElementById('confirmationModal').classList.add('hidden');
        }

        function proceedAction() {
            document.getElementById('confirmationModal').classList.add('hidden');
            
            switch(pendingAction) {
                case 'markAllPresent':
                    markAllPresent();
                    break;
                case 'saveAttendance':
                    showToast('হাজিরা সংরক্ষণ করা হয়েছে!', 'success');
                    break;
                case 'saveStudent':
                    saveStudent();
                    break;
                case 'deleteStudent':
                    if (confirmationData) {
                        deleteStudent(confirmationData);
                    }
                    break;
                case 'importConfirm':
                    importConfirm(confirmationData);
                    break;
                case 'clearData':
                    showDeleteConfirmation('clearData', 'সমস্ত ডেটা ডিলিট করবেন?', 'clearData');
                    break;
            }
            
            pendingAction = null;
            confirmationData = null;
        }

        // সব ডেটা ডিলিট
        function clearAllData() {
            // Clear from Firebase
            if (firebaseInitialized && isFirebaseConnected) {
                // Delete all students
                students.forEach(student => {
                    deleteStudentFromFirebase(student.id);
                });
                
                // Clear teachers
                db.collection(TEACHERS_COLLECTION).doc('classTeachers').delete();
                
                // Clear settings
                db.collection(SETTINGS_COLLECTION).doc('appSettings').delete();
            }
            
            // Clear local data
            students = [];
            attendance = [];
            teachers = {};
            selectedStudents.clear();
            
            // Clear all filters and reload
            currentFilterClass = '';
            
            // Save locally
            saveToLocal('students', students);
            saveToLocal('attendance', attendance);
            saveToLocal('teachers', teachers);
            
            updateUI();
            
            showToast('সমস্ত ডেটা সফলভাবে ডিলিট করা হয়েছে!', 'success');
        }

        // মডেল কন্ট্রোল
        function showAddStudentModal() {
            document.getElementById('modalTitle').textContent = 'নতুন ছাত্র যোগ';
            document.getElementById('studentId').value = '';
            document.getElementById('studentRoll').value = '';
            document.getElementById('studentName').value = '';
            document.getElementById('studentClass').value = '';
            document.getElementById('studentFather').value = '';
            document.getElementById('studentMobile').value = '';
            document.getElementById('studentAddress').value = '';
            document.getElementById('studentNote').value = '';
            currentStudentId = null;
            document.getElementById('addStudentModal').classList.remove('hidden');
        }

        function generateStudentId() {
            const nextId = students.length + 1;
            document.getElementById('studentId').value = `STD-${nextId.toString().padStart(3, '0')}`;
            showToast('নতুন আইডি জেনারেট করা হয়েছে!', 'info');
        }

        function closeModal() {
            document.getElementById('addStudentModal').classList.add('hidden');
        }

        function closeClassSheetsModal() {
            document.getElementById('classSheetsModal').classList.add('hidden');
        }

        function closeTeacherModal() {
            document.getElementById('teacherManagementModal').classList.add('hidden');
        }

        function closeReportModal() {
            document.getElementById('reportModal').classList.add('hidden');
        }

        // টোয়াস্ট মেসেজ
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toast.className = 'toast hidden';
            toastMessage.textContent = message;
            
            // টাইপ সেট করুন
            toast.classList.add(`toast-${type}`);
            
            // আইকন সেট করুন
            const icon = toast.querySelector('i');
            if (type === 'success') {
                icon.className = 'fas fa-check-circle text-xl';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle text-xl';
            } else if (type === 'warning') {
                icon.className = 'fas fa-exclamation-triangle text-xl';
            } else {
                icon.className = 'fas fa-info-circle text-xl';
            }
            
            // টোয়াস্ট দেখান
            toast.classList.remove('hidden');
            
            // ৩ সেকেন্ড পর অটো হাইড
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // PWA Installation Functions
        function addToHomeScreen() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the A2HS prompt');
                        localStorage.setItem('pwaInstalled', 'true');
                        checkPWAStatus();
                        showToast('অ্যাপটি ইন্সটল করা হয়েছে!', 'success');
                    }
                    deferredPrompt = null;
                });
            } else {
                showToast('অ্যাপ ইন্সটল করার অপশন পাওয়া যায়নি।', 'warning');
            }
        }

        // Network Status Monitoring
        function monitorNetworkStatus() {
            const offlineIndicator = document.getElementById('offlineIndicator');
            const onlineIndicator = document.getElementById('onlineIndicator');
            
            window.addEventListener('online', () => {
                onlineIndicator.classList.add('show');
                setTimeout(() => {
                    onlineIndicator.classList.remove('show');
                }, 3000);
            });

            window.addEventListener('offline', () => {
                offlineIndicator.classList.add('show');
            });
        }

        // Register Service Worker
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('New service worker found!');
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showUpdateToast();
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            }
        }

        // App Update Toast
        function showUpdateToast() {
            const updateToast = document.createElement('div');
            updateToast.className = 'toast toast-info';
            updateToast.style.position = 'fixed';
            updateToast.style.top = '20px';
            updateToast.style.left = '50%';
            updateToast.style.transform = 'translateX(-50%)';
            updateToast.style.zIndex = '10001';
            updateToast.innerHTML = `
                <i class="fas fa-sync-alt"></i>
                <span>নতুন আপডেট পাওয়া গেছে!</span>
                <button onclick="location.reload()" style="margin-left: 15px; background: white; color: #3b82f6; border: none; padding: 5px 10px; border-radius: 5px; font-weight: bold; cursor: pointer;">
                    আপডেট করুন
                </button>
            `;
            document.body.appendChild(updateToast);
            updateToast.classList.remove('hidden');
            
            setTimeout(() => {
                updateToast.remove();
            }, 10000);
        }

        // PWA Install Prompt
        function setupInstallPrompt() {
            const pwaInstallPrompt = document.getElementById('pwaInstallPrompt');
            const pwaInstallCancel = document.getElementById('pwaInstallCancel');
            const pwaInstallConfirm = document.getElementById('pwaInstallConfirm');

            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                // Show install prompt after 10 seconds if not already installed
                if (!isPWAInstalled) {
                    setTimeout(() => {
                        if (!localStorage.getItem('pwaInstallDismissed')) {
                            pwaInstallPrompt.classList.add('show');
                        }
                    }, 10000);
                }
            });

            pwaInstallCancel.addEventListener('click', () => {
                pwaInstallPrompt.classList.remove('show');
                localStorage.setItem('pwaInstallDismissed', 'true');
            });

            pwaInstallConfirm.addEventListener('click', () => {
                pwaInstallPrompt.classList.remove('show');
                addToHomeScreen();
            });
        }

        // PWA Initialization
        function initializePWA() {
            checkPWAStatus();
            registerServiceWorker();
            monitorNetworkStatus();
            setupInstallPrompt();
        }

        // Page Specific Functions
        function loadReportStats() {
            // Calculate daily present count
            const today = new Date().toDateString();
            const todayAttendance = attendance.filter(a => a.date === today);
            const presentToday = todayAttendance.filter(a => a.status === 'present').length;
            
            document.getElementById('dailyPresentCount').textContent = toBangla(presentToday);
            
            // Calculate weekly average
            let weeklyTotal = 0;
            let weeklyDays = 0;
            
            for (let i = 0; i < 7; i++) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                const dayAttendance = attendance.filter(a => a.date === dateStr);
                const presentCount = dayAttendance.filter(a => a.status === 'present').length;
                
                if (dayAttendance.length > 0) {
                    const rate = students.length > 0 ? Math.round((presentCount / students.length) * 100) : 0;
                    weeklyTotal += rate;
                    weeklyDays++;
                }
            }
            
            const weeklyAvg = weeklyDays > 0 ? Math.round(weeklyTotal / weeklyDays) : 0;
            document.getElementById('weeklyAvg').textContent = toBangla(weeklyAvg) + '%';
            
            // Calculate monthly average (simplified)
            const monthlyAvg = weeklyAvg > 0 ? weeklyAvg - 5 : 0;
            document.getElementById('monthlyAvg').textContent = toBangla(monthlyAvg) + '%';
            
            // Class count
            const uniqueClasses = [...new Set(students.map(s => s.class))].length;
            document.getElementById('classCount').textContent = toBangla(uniqueClasses);
            
            // Student count
            document.getElementById('studentCount').textContent = toBangla(students.length);
            
            // Total present/absent days
            const totalPresent = attendance.filter(a => a.status === 'present').length;
            const totalAbsent = attendance.filter(a => a.status === 'absent').length;
            
            document.getElementById('totalPresentDays').textContent = toBangla(totalPresent);
            document.getElementById('totalAbsentDays').textContent = toBangla(totalAbsent);
            
            // Best and worst attendance
            let bestRate = 0;
            let worstRate = 100;
            
            students.forEach(student => {
                const studentAttendance = attendance.filter(a => a.studentId === student.id);
                if (studentAttendance.length > 0) {
                    const presentCount = studentAttendance.filter(a => a.status === 'present').length;
                    const rate = Math.round((presentCount / studentAttendance.length) * 100);
                    
                    if (rate > bestRate) bestRate = rate;
                    if (rate < worstRate) worstRate = rate;
                }
            });
            
            document.getElementById('bestAttendance').textContent = toBangla(bestRate) + '%';
            document.getElementById('worstAttendance').textContent = toBangla(worstRate) + '%';
        }
        
        function loadClassesTable() {
            const table = document.getElementById('classesTable');
            
            // Class statistics
            const ibtidayeeClasses = ['ibtidayee-1', 'ibtidayee-2', 'ibtidayee-3', 'ibtidayee-4', 'ibtidayee-5'];
            const dakhilClasses = ['dakhil-6', 'dakhil-7', 'dakhil-8', 'dakhil-9', 'dakhil-10'];
            const alimClasses = ['alim-11', 'alim-12'];
            
            // Update counts
            document.getElementById('ibtidayeeCount').textContent = toBangla(ibtidayeeClasses.length);
            document.getElementById('dakhilCount').textContent = toBangla(dakhilClasses.length);
            document.getElementById('alimCount').textContent = toBangla(alimClasses.length);
            
            let html = '';
            
            // Combine all classes
            const allClasses = [...ibtidayeeClasses, ...dakhilClasses, ...alimClasses];
            
            allClasses.forEach(classValue => {
                const classInfo = getClassLabel(classValue);
                const teacherName = getClassTeacher(classValue);
                const classStudents = students.filter(s => s.class === classValue);
                const studentCount = classStudents.length;
                
                // Calculate today's attendance for this class
                const today = new Date().toDateString();
                let presentToday = 0;
                
                classStudents.forEach(student => {
                    const studentAttendance = attendance.find(a => 
                        a.studentId === student.id && a.date === today
                    );
                    if (studentAttendance && studentAttendance.status === 'present') {
                        presentToday++;
                    }
                });
                
                const attendanceRate = studentCount > 0 ? Math.round((presentToday / studentCount) * 100) : 0;
                
                html += `
                    <tr>
                        <td>
                            <span class="${classInfo.badge} class-badge">${classInfo.label}</span>
                        </td>
                        <td>
                            <div class="font-semibold text-gray-800">${teacherName}</div>
                        </td>
                        <td>
                            <span class="font-bold">${toBangla(studentCount)}</span>
                        </td>
                        <td>
                            <span class="font-bold ${presentToday > 0 ? 'text-green-600' : 'text-red-600'}">
                                ${toBangla(presentToday)}
                            </span>
                        </td>
                        <td>
                            <div class="flex items-center gap-2">
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-gradient-to-r ${attendanceRate >= 90 ? 'from-green-500 to-emerald-500' : attendanceRate >= 70 ? 'from-blue-500 to-cyan-500' : attendanceRate >= 50 ? 'from-yellow-500 to-amber-500' : 'from-red-500 to-pink-500'} h-2 rounded-full" 
                                         style="width: ${attendanceRate}%"></div>
                                </div>
                                <span class="text-sm font-bold ${attendanceRate >= 90 ? 'text-green-600' : attendanceRate >= 70 ? 'text-blue-600' : attendanceRate >= 50 ? 'text-yellow-600' : 'text-red-600'}">
                                    ${toBangla(attendanceRate)}%
                                </span>
                            </div>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button onclick="filterByClass('${classValue}'); navigateToPage('attendance');" class="action-btn action-btn-view">
                                    <i class="fas fa-eye"></i> দেখুন
                                </button>
                                <button onclick="showClassStudents('${classValue}')" class="action-btn action-btn-edit">
                                    <i class="fas fa-list"></i> তালিকা
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            table.innerHTML = html;
        }
        
        function showClassStudents(classValue) {
            const classStudents = students.filter(s => s.class === classValue);
            const classInfo = getClassLabel(classValue);
            const teacherName = getClassTeacher(classValue);
            
            let content = `
                <h3 class="text-lg font-bold mb-4">${classInfo.label} - ছাত্র তালিকা</h3>
                <div class="text-sm text-purple-600 font-semibold mb-6">
                    শ্রেণি শিক্ষক: ${teacherName} | মোট ছাত্র: ${toBangla(classStudents.length)}
                </div>
                <div class="max-h-96 overflow-y-auto">
            `;
            
            if (classStudents.length === 0) {
                content += `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-user-graduate text-3xl mb-3"></i>
                        <div>এই শ্রেণিতে কোন ছাত্র নেই</div>
                    </div>
                `;
            } else {
                classStudents.sort((a, b) => a.roll - b.roll).forEach((student, index) => {
                    const attendanceCount = attendance.filter(a => a.studentId === student.id && a.status === 'present').length;
                    const totalCount = attendance.filter(a => a.studentId === student.id).length;
                    const attendanceRate = totalCount > 0 ? Math.round((attendanceCount / totalCount) * 100) : 0;
                    
                    content += `
                        <div class="flex items-center justify-between p-4 ${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'} rounded-xl mb-3 shadow-sm">
                            <div class="flex-1">
                                <div class="flex items-center gap-4">
                                    <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white p-3 rounded-full">
                                        <span class="font-bold">${toBangla(student.roll)}</span>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-800">${student.name}</div>
                                        <div class="text-sm text-gray-600 mt-1">
                                            আইডি: ${student.id} | পিতা: ${student.father}
                                        </div>
                                        <div class="text-xs text-blue-600 mt-1">
                                            উপস্থিতি: ${toBangla(attendanceRate)}% (${toBangla(attendanceCount)}/${toBangla(totalCount)})
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <button onclick="viewStudentDetails('${student.id}')" class="btn btn-info text-sm">
                                    <i class="fas fa-eye"></i> বিস্তারিত
                                </button>
                            </div>
                        </div>
                    `;
                });
            }
            
            content += `
                </div>
                <div class="mt-6 pt-6 border-t">
                    <div class="flex gap-4">
                        <button onclick="closeReportModal()" class="btn bg-gradient-to-r from-gray-500 to-gray-600 flex-1">
                            <i class="fas fa-times"></i> বন্ধ করুন
                        </button>
                        <button onclick="filterByClass('${classValue}'); navigateToPage('attendance'); closeReportModal();" class="btn btn-primary flex-1">
                            <i class="fas fa-calendar-check"></i> হাজিরা করুন
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('reportTitle').textContent = `${classInfo.label} - ছাত্র তালিকা`;
            document.getElementById('reportContent').innerHTML = content;
            document.getElementById('reportModal').classList.remove('hidden');
        }
        
        function loadSettings() {
            // Load saved settings
            const settings = JSON.parse(localStorage.getItem('madrasaSettings') || '{}');
            
            // Set toggle values
            if (settings.banglaDate !== undefined) {
                document.getElementById('banglaDateToggle').checked = settings.banglaDate;
            }
            if (settings.autoSave !== undefined) {
                document.getElementById('autoSaveToggle').checked = settings.autoSave;
            }
            if (settings.notification !== undefined) {
                document.getElementById('notificationToggle').checked = settings.notification;
            }
            if (settings.offlineMode !== undefined) {
                document.getElementById('offlineModeToggle').checked = settings.offlineMode;
            }
            if (settings.syncData !== undefined) {
                document.getElementById('syncDataToggle').checked = settings.syncData;
            }
            if (settings.firebaseSync !== undefined) {
                document.getElementById('firebaseSyncToggle').checked = settings.firebaseSync;
            }
            
            // Add event listeners to save settings
            document.querySelectorAll('#settings input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', saveSettings);
            });
        }
        
        function applySettings(settings) {
            // Apply settings to UI
            if (settings.banglaDate !== undefined) {
                document.getElementById('banglaDateToggle').checked = settings.banglaDate;
            }
            if (settings.autoSave !== undefined) {
                document.getElementById('autoSaveToggle').checked = settings.autoSave;
            }
            if (settings.notification !== undefined) {
                document.getElementById('notificationToggle').checked = settings.notification;
            }
            if (settings.offlineMode !== undefined) {
                document.getElementById('offlineModeToggle').checked = settings.offlineMode;
            }
            if (settings.syncData !== undefined) {
                document.getElementById('syncDataToggle').checked = settings.syncData;
            }
            if (settings.firebaseSync !== undefined) {
                document.getElementById('firebaseSyncToggle').checked = settings.firebaseSync;
            }
        }
        
        function saveSettings() {
            const settings = {
                banglaDate: document.getElementById('banglaDateToggle').checked,
                autoSave: document.getElementById('autoSaveToggle').checked,
                notification: document.getElementById('notificationToggle').checked,
                offlineMode: document.getElementById('offlineModeToggle').checked,
                syncData: document.getElementById('syncDataToggle').checked,
                firebaseSync: document.getElementById('firebaseSyncToggle').checked
            };
            
            // Save to local storage
            localStorage.setItem('madrasaSettings', JSON.stringify(settings));
            
            // Save to Firebase if connected
            if (firebaseInitialized && isFirebaseConnected) {
                db.collection(SETTINGS_COLLECTION).doc('appSettings').set(settings)
                    .then(() => {
                        console.log("Settings saved to Firebase");
                    })
                    .catch((error) => {
                        console.error("Error saving settings: ", error);
                    });
            }
            
            showToast('সেটিংস সংরক্ষণ করা হয়েছে!', 'success');
        }
        
        function resetSettings() {
            localStorage.removeItem('madrasaSettings');
            loadSettings();
            showToast('সেটিংস রিসেট করা হয়েছে!', 'success');
        }
        
        function exportStudents() {
            const today = new Date();
            const dateStr = `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;
            
            let csv = 'আইডি,রোল,নাম,শ্রেণি,শ্রেণি শিক্ষক,পিতা,মোবাইল,ঠিকানা,বিশেষ মন্তব্য\n';
            
            students.forEach(student => {
                const teacherName = getClassTeacher(student.class);
                
                csv += `${student.id},${student.roll},${student.name},${getClassLabel(student.class).label},${teacherName},${student.father},${student.mobile || ''},${student.address || ''},${student.note || ''}\n`;
            });
            
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `ছাত্র-তালিকা-${dateStr}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('ছাত্র তালিকা ডাউনলোড করা হয়েছে!', 'success');
        }
        
        function exportAllData() {
            const today = new Date();
            const dateStr = `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;
            
            const allData = {
                students: students,
                attendance: attendance,
                teachers: teachers,
                settings: JSON.parse(localStorage.getItem('madrasaSettings') || '{}'),
                exportDate: new Date().toISOString()
            };
            
            const jsonData = JSON.stringify(allData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `মাদ্রাসা-ডেটা-ব্যাকআপ-${dateStr}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('সম্পূর্ণ ডেটা ব্যাকআপ করা হয়েছে!', 'success');
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        
                        // Validate imported data
                        if (!importedData.students || !importedData.attendance) {
                            showToast('ইমপোর্ট ফাইলটি সঠিক নয়!', 'error');
                            return;
                        }
                        
                        confirmAction('importConfirm', 'ডেটা ইমপোর্ট করতে চান?', 
                            `নতুন ডেটা যোগ হবে:\nছাত্র: ${importedData.students.length}\nহাজিরা রেকর্ড: ${importedData.attendance.length}\n\nপুরানো ডেটা মুছে যাবে না।`, 
                            importedData);
                    } catch (error) {
                        showToast('ফাইল পড়তে সমস্যা হয়েছে!', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        function importConfirm(data) {
            // Merge imported data
            if (data.students) {
                // Add new students without duplicates
                data.students.forEach(newStudent => {
                    const exists = students.some(s => s.id === newStudent.id);
                    if (!exists) {
                        students.push(newStudent);
                        // Save to Firebase
                        saveStudentToFirebase(newStudent);
                    }
                });
            }
            
            if (data.attendance) {
                // Add new attendance records without duplicates
                data.attendance.forEach(newRecord => {
                    const exists = attendance.some(a => 
                        a.studentId === newRecord.studentId && a.date === newRecord.date
                    );
                    if (!exists) {
                        attendance.push(newRecord);
                        // Save to Firebase
                        saveAttendanceToFirebase(newRecord);
                    }
                });
            }
            
            if (data.teachers) {
                // Merge teachers
                teachers = { ...teachers, ...data.teachers };
                // Save to Firebase
                saveTeachersToFirebase();
            }
            
            if (data.settings) {
                // Merge settings
                const currentSettings = JSON.parse(localStorage.getItem('madrasaSettings') || '{}');
                const mergedSettings = { ...currentSettings, ...data.settings };
                localStorage.setItem('madrasaSettings', JSON.stringify(mergedSettings));
                applySettings(mergedSettings);
            }
            
            // Save locally
            saveToLocal('students', students);
            saveToLocal('attendance', attendance);
            saveToLocal('teachers', teachers);
            
            updateUI();
            
            showToast('ডেটা সফলভাবে ইমপোর্ট করা হয়েছে!', 'success');
        }
        
        function showAddClassModal() {
            showToast('এই ফিচারটি শীঘ্রই আসছে!', 'info');
        }
        
        function showImportModal() {
            importData();
        }
        
        function showClassWiseReport() {
            let content = `
                <h3 class="text-lg font-bold mb-6">শ্রেণিভিত্তিক হাজিরা রিপোর্ট</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr>
                                <th>শ্রেণি</th>
                                <th>ছাত্র সংখ্যা</th>
                                <th>আজ উপস্থিত</th>
                                <th>উপস্থিতি হার</th>
                                <th>গড় উপস্থিতি</th>
                                <th>বিস্তারিত</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            const allClasses = [...new Set(students.map(s => s.class))];
            const today = new Date().toDateString();
            
            allClasses.forEach(classValue => {
                const classInfo = getClassLabel(classValue);
                const teacherName = getClassTeacher(classValue);
                const classStudents = students.filter(s => s.class === classValue);
                const studentCount = classStudents.length;
                
                // Calculate today's attendance
                let presentToday = 0;
                classStudents.forEach(student => {
                    const studentAttendance = attendance.find(a => 
                        a.studentId === student.id && a.date === today
                    );
                    if (studentAttendance && studentAttendance.status === 'present') {
                        presentToday++;
                    }
                });
                
                const todayRate = studentCount > 0 ? Math.round((presentToday / studentCount) * 100) : 0;
                
                // Calculate overall average attendance for this class
                let totalPresent = 0;
                let totalDays = 0;
                
                classStudents.forEach(student => {
                    const studentAttendance = attendance.filter(a => a.studentId === student.id);
                    if (studentAttendance.length > 0) {
                        const presentCount = studentAttendance.filter(a => a.status === 'present').length;
                        totalPresent += presentCount;
                        totalDays += studentAttendance.length;
                    }
                });
                
                const avgRate = totalDays > 0 ? Math.round((totalPresent / totalDays) * 100) : 0;
                
                content += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="py-3 px-4">
                            <div class="font-semibold">${classInfo.label}</div>
                            <div class="text-xs text-purple-600">${teacherName}</div>
                        </td>
                        <td class="py-3 px-4">
                            <span class="font-bold">${toBangla(studentCount)}</span>
                        </td>
                        <td class="py-3 px-4">
                            <span class="font-bold ${presentToday > 0 ? 'text-green-600' : 'text-red-600'}">
                                ${toBangla(presentToday)}
                            </span>
                        </td>
                        <td class="py-3 px-4">
                            <span class="${todayRate >= 90 ? 'text-green-600' : todayRate >= 70 ? 'text-blue-600' : todayRate >= 50 ? 'text-yellow-600' : 'text-red-600'} font-bold">
                                ${toBangla(todayRate)}%
                            </span>
                        </td>
                        <td class="py-3 px-4">
                            <span class="${avgRate >= 90 ? 'text-green-600' : avgRate >= 70 ? 'text-blue-600' : avgRate >= 50 ? 'text-yellow-600' : 'text-red-600'} font-bold">
                                ${toBangla(avgRate)}%
                            </span>
                        </td>
                        <td class="py-3 px-4">
                            <button onclick="showClassStudents('${classValue}')" class="btn btn-info text-sm py-1">
                                <i class="fas fa-eye"></i> দেখুন
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            content += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-phone-alt text-blue-500"></i>
                        <div>
                            <div class="text-sm text-blue-600">প্রয়োজনে যোগাযোগ:</div>
                            <div class="font-bold text-blue-800">০১৮১১২৩৬৫৪৮</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('reportTitle').textContent = 'শ্রেণিভিত্তিক হাজিরা রিপোর্ট';
            document.getElementById('reportContent').innerHTML = content;
            document.getElementById('reportModal').classList.remove('hidden');
        }
        
        function showStudentReports() {
            let content = `
                <h3 class="text-lg font-bold mb-6">ছাত্রভিত্তিক হাজিরা রিপোর্ট</h3>
                <div class="mb-6">
                    <input type="text" id="searchStudentReport" class="search-box" placeholder="ছাত্রের নাম দিয়ে খুঁজুন..." onkeyup="filterStudentReports()">
                </div>
                <div class="max-h-96 overflow-y-auto" id="studentReportsList">
            `;
            
            if (students.length === 0) {
                content += `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-user-graduate text-3xl mb-3"></i>
                        <div>কোন ছাত্র নেই</div>
                    </div>
                `;
            } else {
                students.sort((a, b) => a.roll - b.roll).forEach((student, index) => {
                    const classInfo = getClassLabel(student.class);
                    const teacherName = getClassTeacher(student.class);
                    
                    const studentAttendance = attendance.filter(a => a.studentId === student.id);
                    const presentCount = studentAttendance.filter(a => a.status === 'present').length;
                    const totalCount = studentAttendance.length;
                    const attendanceRate = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
                    
                    content += `
                        <div class="flex items-center justify-between p-4 ${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'} rounded-xl mb-3 shadow-sm student-report-item">
                            <div class="flex-1">
                                <div class="flex items-center gap-4">
                                    <div class="bg-gradient-to-r ${attendanceRate >= 90 ? 'from-green-500 to-emerald-500' : attendanceRate >= 70 ? 'from-blue-500 to-cyan-500' : attendanceRate >= 50 ? 'from-yellow-500 to-amber-500' : 'from-red-500 to-pink-500'} text-white p-3 rounded-full">
                                        <span class="font-bold">${toBangla(student.roll)}</span>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-800 student-name">${student.name}</div>
                                        <div class="text-sm text-gray-600 mt-1">
                                            আইডি: ${student.id} | শ্রেণি: ${classInfo.label}
                                        </div>
                                        <div class="text-xs text-purple-600 mt-1">শিক্ষক: ${teacherName}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold ${attendanceRate >= 90 ? 'text-green-600' : attendanceRate >= 70 ? 'text-blue-600' : attendanceRate >= 50 ? 'text-yellow-600' : 'text-red-600'}">
                                    ${toBangla(attendanceRate)}%
                                </div>
                                <div class="text-xs text-gray-600">
                                    ${toBangla(presentCount)}/${toBangla(totalCount)}
                                </div>
                            </div>
                            <div class="ml-4">
                                <button onclick="viewStudentDetails('${student.id}')" class="btn btn-info text-sm">
                                    <i class="fas fa-eye"></i> বিস্তারিত
                                </button>
                            </div>
                        </div>
                    `;
                });
            }
            
            content += `
                </div>
                <div class="mt-6 pt-6 border-t">
                    <div class="flex gap-4">
                        <button onclick="closeReportModal()" class="btn bg-gradient-to-r from-gray-500 to-gray-600 flex-1">
                            <i class="fas fa-times"></i> বন্ধ করুন
                        </button>
                        <button onclick="exportData()" class="btn btn-success flex-1">
                            <i class="fas fa-download"></i> এক্সপোর্ট করুন
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('reportTitle').textContent = 'ছাত্রভিত্তিক হাজিরা রিপোর্ট';
            document.getElementById('reportContent').innerHTML = content;
            document.getElementById('reportModal').classList.remove('hidden');
        }
        
        function filterStudentReports() {
            const searchText = document.getElementById('searchStudentReport').value.toLowerCase();
            const items = document.querySelectorAll('.student-report-item');
            
            items.forEach(item => {
                const studentName = item.querySelector('.student-name').textContent.toLowerCase();
                if (studentName.includes(searchText)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        function showMonthlyReport() {
            let content = `
                <h3 class="text-lg font-bold mb-6">মাসিক হাজিরা রিপোর্ট</h3>
                <div class="mb-6">
                    <select id="monthSelect" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition" onchange="loadMonthlyReport()">
                        <option value="0">জানুয়ারী</option>
                        <option value="1">ফেব্রুয়ারী</option>
                        <option value="2">মার্চ</option>
                        <option value="3">এপ্রিল</option>
                        <option value="4">মে</option>
                        <option value="5">জুন</option>
                        <option value="6">জুলাই</option>
                        <option value="7">আগস্ট</option>
                        <option value="8">সেপ্টেম্বর</option>
                        <option value="9">অক্টোবর</option>
                        <option value="10">নভেম্বর</option>
                        <option value="11">ডিসেম্বর</option>
                    </select>
                </div>
                <div id="monthlyReportContent">
                    <!-- মাসিক রিপোর্ট লোড হবে -->
                </div>
            `;
            
            document.getElementById('reportTitle').textContent = 'মাসিক হাজিরা রিপোর্ট';
            document.getElementById('reportContent').innerHTML = content;
            document.getElementById('reportModal').classList.remove('hidden');
            
            // Set current month
            const currentMonth = new Date().getMonth();
            document.getElementById('monthSelect').value = currentMonth;
            
            loadMonthlyReport();
        }
        
        function loadMonthlyReport() {
            const monthSelect = document.getElementById('monthSelect');
            if (!monthSelect) return;
            
            const selectedMonth = parseInt(monthSelect.value);
            const currentYear = new Date().getFullYear();
            
            // Calculate days in month
            const daysInMonth = new Date(currentYear, selectedMonth + 1, 0).getDate();
            
            let monthlyData = [];
            
            // Collect data for each day
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, selectedMonth, day);
                const dateStr = date.toDateString();
                
                const dayAttendance = attendance.filter(a => {
                    const attDate = new Date(a.date);
                    return attDate.getDate() === day && 
                           attDate.getMonth() === selectedMonth && 
                           attDate.getFullYear() === currentYear;
                });
                
                const presentCount = dayAttendance.filter(a => a.status === 'present').length;
                const absentCount = dayAttendance.filter(a => a.status === 'absent').length;
                const totalCount = students.length;
                const rate = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
                
                monthlyData.push({
                    day: day,
                    date: date,
                    present: presentCount,
                    absent: absentCount,
                    rate: rate,
                    hasData: dayAttendance.length > 0
                });
            }
            
            // Calculate monthly statistics
            const daysWithData = monthlyData.filter(d => d.hasData).length;
            const totalPresent = monthlyData.reduce((sum, day) => sum + day.present, 0);
            const totalPossible = daysWithData * students.length;
            const monthlyRate = totalPossible > 0 ? Math.round((totalPresent / totalPossible) * 100) : 0;
            
            let reportContent = `
                <div class="mb-6 p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-200">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-purple-600 mb-2">${toBangla(monthlyRate)}%</div>
                        <div class="text-gray-700">মাসিক গড় উপস্থিতি</div>
                        <div class="text-sm text-gray-600 mt-2">
                            ${banglaMonths[selectedMonth]} ${toBangla(currentYear)} | 
                            ${toBangla(daysWithData)} দিনের ডেটা
                        </div>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr>
                                <th>তারিখ</th>
                                <th>দিন</th>
                                <th>উপস্থিত</th>
                                <th>অনুপস্থিত</th>
                                <th>হার</th>
                                <th>বিস্তারিত</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            monthlyData.forEach(dayData => {
                const dayName = banglaDays[dayData.date.getDay()];
                const hasDataClass = dayData.hasData ? '' : 'opacity-50';
                
                reportContent += `
                    <tr class="${hasDataClass}">
                        <td class="py-3 px-4">
                            <div class="font-semibold">${toBangla(dayData.day)} ${banglaMonths[selectedMonth]}</div>
                            <div class="text-sm text-gray-600">${toBangla(currentYear)}</div>
                        </td>
                        <td class="py-3 px-4">${dayName}</td>
                        <td class="py-3 px-4">
                            <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-bold">
                                ${toBangla(dayData.present)}
                            </span>
                        </td>
                        <td class="py-3 px-4">
                            <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-bold">
                                ${toBangla(dayData.absent)}
                            </span>
                        </td>
                        <td class="py-3 px-4">
                            <span class="${dayData.rate >= 90 ? 'text-green-600' : dayData.rate >= 70 ? 'text-blue-600' : dayData.rate >= 50 ? 'text-yellow-600' : 'text-red-600'} font-bold">
                                ${toBangla(dayData.rate)}%
                            </span>
                        </td>
                        <td class="py-3 px-4">
                            ${dayData.hasData ? 
                                `<button onclick="showDayReport('${dayData.date.toDateString()}')" class="btn btn-info text-sm py-1">
                                    <i class="fas fa-eye"></i> দেখুন</button>` :
                                '<span class="text-gray-400 text-sm">ডেটা নাই</span>'
                            }
                        </td>
                    </tr>
                `;
            });
            
            reportContent += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-phone-alt text-blue-500"></i>
                        <div>
                            <div class="text-sm text-blue-600">প্রয়োজনে যোগাযোগ:</div>
                            <div class="font-bold text-blue-800">০১৮১১২৩৬৫৪৮</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('monthlyReportContent').innerHTML = reportContent;
        }
        
        function exportData() {
            const today = new Date();
            const dateStr = `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;
            
            let csv = 'আইডি,রোল,নাম,শ্রেণি,শ্রেণি শিক্ষক,পিতা,মোবাইল,ঠিকানা,উপস্থিত,অনুপস্থিত,উপস্থিতি_হার\n';
            
            students.forEach(student => {
                const studentAttendance = attendance.filter(a => a.studentId === student.id);
                const presentCount = studentAttendance.filter(a => a.status === 'present').length;
                const absentCount = studentAttendance.filter(a => a.status === 'absent').length;
                const totalCount = studentAttendance.length;
                const attendanceRate = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
                const teacherName = getClassTeacher(student.class);
                
                csv += `${student.id},${student.roll},${student.name},${getClassLabel(student.class).label},${teacherName},${student.father},${student.mobile || ''},${student.address || ''},${presentCount},${absentCount},${attendanceRate}%\n`;
            });
            
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `হাজিরা-রিপোর্ট-${dateStr}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('সম্পূর্ণ ডেটা ডাউনলোড করা হয়েছে!', 'success');
        }
        
        function checkForUpdates() {
            showToast('আপডেট চেক করা হচ্ছে...', 'info');
            
            setTimeout(() => {
                showToast('আপনার অ্যাপটি সর্বশেষ সংস্করণে আছে!', 'success');
            }, 1500);
        }

        // অতীত তারিখের হাজিরা সংশোধন ফাংশনগুলি
        function showPastDateAttendance() {
            document.getElementById('pastDateSelector').classList.remove('hidden');
            // Set default date to yesterday
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdaysDate = yesterday.toISOString().split('T')[0];
            document.getElementById('pastDateInput').value = yesterdaysDate;
        }
        
        function closePastDateSelector() {
            document.getElementById('pastDateSelector').classList.add('hidden');
            document.getElementById('selectedDateDisplay').classList.add('hidden');
            resetToToday();
        }
        
        function loadPastDateAttendance() {
            const dateInput = document.getElementById('pastDateInput').value;
            if (!dateInput) {
                showToast('দয়া করে একটি তারিখ নির্বাচন করুন!', 'warning');
                return;
            }
            
            selectedPastDate = new Date(dateInput).toDateString();
            isPastDateMode = true;
            
            // Show selected date
            document.getElementById('selectedDateText').textContent = toBanglaDate(selectedPastDate);
            document.getElementById('selectedDateDisplay').classList.remove('hidden');
            
            // Hide date selector
            document.getElementById('pastDateSelector').classList.add('hidden');
            
            // Update attendance table for the selected date
            renderAttendanceTableForDate(selectedPastDate);
            
            showToast(`${toBanglaDate(selectedPastDate)} তারিখের হাজিরা লোড করা হয়েছে!`, 'success');
        }
        
        function resetToToday() {
            selectedPastDate = null;
            isPastDateMode = false;
            
            // Reset date display
            document.getElementById('selectedDateDisplay').classList.add('hidden');
            document.getElementById('pastDateSelector').classList.add('hidden');
            
            // Update to today's attendance
            renderAttendanceTable();
            
            showToast('আজকের হাজিরাতে ফিরে এসেছেন!', 'info');
        }
        
        function showPastDateCorrection() {
            document.getElementById('pastDateCorrectionModal').classList.remove('hidden');
        }
        
        function closePastDateCorrectionModal() {
            document.getElementById('pastDateCorrectionModal').classList.add('hidden');
        }
        
        function loadDateForCorrection() {
            const dateInput = document.getElementById('correctionDateInput').value;
            if (!dateInput) {
                showToast('দয়া করে একটি তারিখ নির্বাচন করুন!', 'warning');
                return;
            }
            
            const dateString = new Date(dateInput).toDateString();
            const banglaDate = toBanglaDate(dateString);
            
            // Get attendance for this date
            const dayAttendance = attendance.filter(a => a.date === dateString);
            
            let content = `
                <h3 class="text-lg font-bold mb-4">${banglaDate} - হাজিরা সংশোধন</h3>
                <div class="mb-6">
                    <div class="bg-gradient-to-r from-orange-50 to-red-50 p-4 rounded-xl border border-orange-200">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-info-circle text-orange-500"></i>
                            <div>
                                <h4 class="font-bold text-orange-700">নির্দেশনা:</h4>
                                <p class="text-orange-600 text-sm">নিচের তালিকা থেকে ছাত্রদের হাজিরা সংশোধন করুন। পরিবর্তনগুলো সাথে সাথে সংরক্ষণ হবে।</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr>
                                <th>রোল</th>
                                <th>নাম</th>
                                <th>শ্রেণি</th>
                                <th>বর্তমান হাজিরা</th>
                                <th>হাজিরা পরিবর্তন</th>
                                <th>সংশোধনের সময়</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            students.sort((a, b) => a.roll - b.roll).forEach((student, index) => {
                const studentAttendance = dayAttendance.find(a => a.studentId === student.id);
                const status = studentAttendance ? studentAttendance.status : 'absent';
                const classInfo = getClassLabel(student.class);
                const correctedTime = studentAttendance && studentAttendance.corrected ? 
                    new Date(studentAttendance.timestamp).toLocaleString('bn-BD') : 'নাই';
                
                content += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="py-3 px-4 text-center font-bold">${toBangla(student.roll)}</td>
                        <td class="py-3 px-4">${student.name}</td>
                        <td class="py-3 px-4">
                            <span class="${classInfo.badge} class-badge text-xs">${classInfo.label}</span>
                        </td>
                        <td class="py-3 px-4">
                            <span class="${status === 'present' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} px-3 py-1 rounded-full text-sm font-bold">
                                ${status === 'present' ? 'উপস্থিত' : 'অনুপস্থিত'}
                            </span>
                        </td>
                        <td class="py-3 px-4">
                            <div class="flex gap-2">
                                <button onclick="markAttendanceForDate('${student.id}', 'present', '${dateString}')" 
                                        class="btn ${status === 'present' ? 'btn-success' : 'btn-outline-success'} text-sm py-1">
                                    <i class="fas fa-check"></i> উপস্থিত
                                </button>
                                <button onclick="markAttendanceForDate('${student.id}', 'absent', '${dateString}')" 
                                        class="btn ${status === 'absent' ? 'btn-danger' : 'btn-outline-danger'} text-sm py-1">
                                    <i class="fas fa-times"></i> অনুপস্থিত
                                </button>
                            </div>
                        </td>
                        <td class="py-3 px-4 text-sm">${correctedTime}</td>
                    </tr>
                `;
            });
            
            content += `
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-6 pt-6 border-t">
                    <div class="flex gap-4">
                        <button onclick="closePastDateCorrectionModal()" class="btn bg-gradient-to-r from-gray-500 to-gray-600 flex-1">
                            <i class="fas fa-times"></i> বন্ধ করুন
                        </button>
                        <button onclick="markAllPresentForDate('${dateString}')" class="btn btn-success flex-1">
                            <i class="fas fa-check-circle"></i> সবাই উপস্থিত
                        </button>
                        <button onclick="loadDateForCorrection()" class="btn btn-primary flex-1">
                            <i class="fas fa-redo"></i> রিফ্রেশ
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('dateCorrectionContent').innerHTML = content;
        }
        
        function markAllPresentForDate(dateString) {
            const banglaDate = getBanglaDateFromString(dateString);
            
            students.forEach(student => {
                const attendanceData = {
                    id: `${student.id}_${dateString}`,
                    studentId: student.id,
                    studentName: student.name,
                    studentClass: student.class,
                    date: dateString,
                    status: 'present',
                    timestamp: new Date().toISOString(),
                    teacher: getClassTeacher(student.class),
                    corrected: true
                };
                
                const existingIndex = attendance.findIndex(a => 
                    a.studentId === student.id && a.date === dateString
                );
                
                if (existingIndex !== -1) {
                    attendance[existingIndex] = attendanceData;
                } else {
                    attendance.push(attendanceData);
                }
                
                // Save to Firebase
                saveAttendanceToFirebase(attendanceData);
            });
            
            // Reload the correction view
            loadDateForCorrection();
            
            showToast(`সবাইকে ${banglaDate} তারিখের জন্য উপস্থিত মার্ক করা হয়েছে!`, 'success');
        }
        
        function showPastDateForClassSheet() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdaysDate = yesterday.toISOString().split('T')[0];
            
            document.getElementById('pastDateCorrectionModal').classList.remove('hidden');
            document.getElementById('correctionDateInput').value = yesterdaysDate;
            loadDateForCorrection();
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Firebase
            initializeFirebase();
            
            // Load data and initialize
            updateDate();
            initializePWA();
            
            // Set current page
            showPage('dashboard');
            
            // Focus on search input if on attendance page
            if (currentPage === 'attendance') {
                setTimeout(() => {
                    document.getElementById('searchInputAttendance')?.focus();
                }, 100);
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                showAddStudentModal();
            }
            
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                showToast('হাজিরা সংরক্ষণ করা হয়েছে!', 'success');
            }
            
            if (e.ctrlKey && e.key === 't') {
                e.preventDefault();
                showTeacherManagement();
            }
            
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                if (currentPage === 'attendance') {
                    document.getElementById('searchInputAttendance')?.focus();
                } else if (currentPage === 'students') {
                    document.getElementById('searchInputStudents')?.focus();
                }
            }
            
            if (e.key === 'Escape') {
                closeModal();
                closeClassSheetsModal();
                closeTeacherModal();
                closeReportModal();
                cancelAction();
                cancelDelete();
                closePastDateCorrectionModal();
                closePastDateSelector();
                toggleMobileMenu(); // ESC-এ মেনু বন্ধ হবে
            }
            
            // PWA Install Shortcut
            if (e.ctrlKey && e.key === 'i') {
                e.preventDefault();
                addToHomeScreen();
            }
            
            // Delete shortcut
            if (e.key === 'Delete' && currentPage === 'students') {
                e.preventDefault();
                if (selectedStudents.size > 0) {
                    showDeleteConfirmation('bulk', 'নির্বাচিত ছাত্র ডিলিট করবেন?', 'bulk');
                }
            }
            
            // অতীত তারিখ মোড টগল (Alt+P)
            if (e.altKey && e.key === 'p') {
                e.preventDefault();
                if (isPastDateMode) {
                    resetToToday();
                } else {
                    showPastDateAttendance();
                }
            }
        });
    </script>
</body>
</html>
